<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>0. Import data as a cubble • cubble</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="0. Import data as a cubble">
<meta property="og:description" content="cubble">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">cubble</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.0.1.0000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/cubble.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/0-import.html">0. Import data as a cubble</a>
    </li>
    <li>
      <a href="../articles/1-cubble-design.html">1. Details on cubble design</a>
    </li>
    <li>
      <a href="../articles/2-aggregation.html">2. Application: hierarchical data structure</a>
    </li>
    <li>
      <a href="../articles/3-matching.html">3. Application: matching</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="0-import_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>0. Import data as a cubble</h1>
            
      
      
      <div class="hidden name"><code>0-import.Rmd</code></div>

    </div>

    
    
<p>This article shows you how to create a cubble from data in the wild. Three examples are given to construct a cubble from:</p>
<ul>
<li>a tibble</li>
<li>a tsibble</li>
<li>NetCDF data</li>
</ul>
<div class="section level3">
<h3 id="a-cubble-from-tibble">A cubble from tibble<a class="anchor" aria-label="anchor" href="#a-cubble-from-tibble"></a>
</h3>
<p>You should have already seen an example of constructing a cubble from a tibble in the README page, here we show an example of turning a row-wise data frame into cubble. A row-wise data frame can be a useful structure when querying data from a database since you can first create a row-wise data frame with all the metadata and then query the data as a nested list. We will show how to convert this row-wise output into a cubble with climate data.</p>
<p>Suppose we are interested in the climate stations close to Melbourne and Sydney, here are ten of them:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">stations</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 10 × 8</span></span>
<span class="co">#&gt;    id            lat  long  elev name                         wmo_id  dist city </span>
<span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> ASN00066037 -<span style="color: #BB0000;">33.9</span>  151.   6   sydney airport amo            <span style="text-decoration: underline;">94</span>767  9.32 sydn…</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> ASN00066194 -<span style="color: #BB0000;">33.9</span>  151.   3   canterbury racecourse aws     <span style="text-decoration: underline;">94</span>766  9.63 sydn…</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> ASN00066124 -<span style="color: #BB0000;">33.8</span>  151.  55   parramatta north (masons dr…  <span style="text-decoration: underline;">94</span>764 19.4  sydn…</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> ASN00066137 -<span style="color: #BB0000;">33.9</span>  151.   6.5 bankstown airport aws         <span style="text-decoration: underline;">94</span>765 21.1  sydn…</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> ASN00068192 -<span style="color: #BB0000;">34.0</span>  151.  73.9 camden airport aws            <span style="text-decoration: underline;">94</span>755 51.4  sydn…</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> ASN00086038 -<span style="color: #BB0000;">37.7</span>  145.  78.4 essendon airport              <span style="text-decoration: underline;">95</span>866 10.8  melb…</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> ASN00086282 -<span style="color: #BB0000;">37.7</span>  145. 113.  melbourne airport             <span style="text-decoration: underline;">94</span>866 20.1  melb…</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> ASN00086077 -<span style="color: #BB0000;">38.0</span>  145.  12.1 moorabbin airport             <span style="text-decoration: underline;">94</span>870 21.9  melb…</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> ASN00088162 -<span style="color: #BB0000;">37.4</span>  145. 528.  wallan (kilmore gap)          <span style="text-decoration: underline;">94</span>860 48.1  melb…</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">10</span> ASN00087113 -<span style="color: #BB0000;">38.0</span>  144.  10.6 avalon airport                <span style="text-decoration: underline;">94</span>854 48.8  melb…</span></code></pre></div>
<p>Such a dataset can be constructed via subsetting a station master list, i.e. <code><a href="https://docs.ropensci.org/rnoaa/reference/ghcnd_stations.html" class="external-link">rnoaa::ghcnd_stations()</a></code>, with some criteria on variable, distance and recording years. The time series of climate variables can be queried by <code><a href="https://docs.ropensci.org/rnoaa/reference/meteo_pull_monitors.html" class="external-link">rnoaa::meteo_pull_monitors()</a></code> with the date range and variable supplied. Here we turn the <code>stations</code> data into a rowwise data frame and then query the climate variables as a list-column, <code>ts</code>:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">raw</span> <span class="op">&lt;-</span> <span class="va">stations</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rowwise.html" class="external-link">rowwise</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>ts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu">rnoaa</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/rnoaa/reference/meteo_pull_monitors.html" class="external-link">meteo_pull_monitors</a></span><span class="op">(</span><span class="va">id</span>, 
                                       date_min <span class="op">=</span> <span class="st">"2020-01-01"</span>, 
                                       date_max <span class="op">=</span> <span class="st">"2020-12-31"</span>,
                                       var <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"PRCP"</span>, <span class="st">"TMAX"</span>, <span class="st">"TMIN"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> 
<span class="va">raw</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 10 × 9</span></span>
<span class="co">#&gt; <span style="color: #949494;"># Rowwise: </span></span>
<span class="co">#&gt;    id            lat  long  elev name                wmo_id  dist city  ts      </span>
<span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>  </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> ASN00066037 -<span style="color: #BB0000;">33.9</span>  151.   6   sydney airport amo   <span style="text-decoration: underline;">94</span>767  9.32 sydn… &lt;tibble&gt;</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> ASN00066194 -<span style="color: #BB0000;">33.9</span>  151.   3   canterbury racecou…  <span style="text-decoration: underline;">94</span>766  9.63 sydn… &lt;tibble&gt;</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> ASN00066124 -<span style="color: #BB0000;">33.8</span>  151.  55   parramatta north (…  <span style="text-decoration: underline;">94</span>764 19.4  sydn… &lt;tibble&gt;</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> ASN00066137 -<span style="color: #BB0000;">33.9</span>  151.   6.5 bankstown airport …  <span style="text-decoration: underline;">94</span>765 21.1  sydn… &lt;tibble&gt;</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> ASN00068192 -<span style="color: #BB0000;">34.0</span>  151.  73.9 camden airport aws   <span style="text-decoration: underline;">94</span>755 51.4  sydn… &lt;tibble&gt;</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> ASN00086038 -<span style="color: #BB0000;">37.7</span>  145.  78.4 essendon airport     <span style="text-decoration: underline;">95</span>866 10.8  melb… &lt;tibble&gt;</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> ASN00086282 -<span style="color: #BB0000;">37.7</span>  145. 113.  melbourne airport    <span style="text-decoration: underline;">94</span>866 20.1  melb… &lt;tibble&gt;</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> ASN00086077 -<span style="color: #BB0000;">38.0</span>  145.  12.1 moorabbin airport    <span style="text-decoration: underline;">94</span>870 21.9  melb… &lt;tibble&gt;</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> ASN00088162 -<span style="color: #BB0000;">37.4</span>  145. 528.  wallan (kilmore ga…  <span style="text-decoration: underline;">94</span>860 48.1  melb… &lt;tibble&gt;</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">10</span> ASN00087113 -<span style="color: #BB0000;">38.0</span>  144.  10.6 avalon airport       <span style="text-decoration: underline;">94</span>854 48.8  melb… &lt;tibble&gt;</span></code></pre></div>
<p>The nested data is then ready to be turned into a cubble with:</p>
<ul>
<li>
<code>id</code> as the key to identify each station,</li>
<li>
<code>date</code> as the index to identify time, and</li>
<li>
<code>coords</code> to identify the spatial coordinates of each station.</li>
</ul>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sydmel_climate</span> <span class="op">&lt;-</span> <span class="va">raw</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="../reference/cubble-class.html">as_cubble</a></span><span class="op">(</span>key <span class="op">=</span> <span class="va">id</span>, index <span class="op">=</span> <span class="va">date</span>, coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">long</span>, <span class="va">lat</span><span class="op">)</span><span class="op">)</span>

<span class="va">sydmel_climate</span>
<span class="co">#&gt; <span style="color: #949494;"># cubble:   id [10]: nested form</span></span>
<span class="co">#&gt; <span style="color: #949494;"># bbox:     [144.47, -38.03, 151.18, -33.79]</span></span>
<span class="co">#&gt; <span style="color: #949494;"># temporal: date [date], prcp [dbl], tmax [dbl], tmin [dbl]</span></span>
<span class="co">#&gt;    id            lat  long  elev name                wmo_id  dist city  ts      </span>
<span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>  </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> ASN00066037 -<span style="color: #BB0000;">33.9</span>  151.   6   sydney airport amo   <span style="text-decoration: underline;">94</span>767  9.32 sydn… &lt;tibble&gt;</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> ASN00066194 -<span style="color: #BB0000;">33.9</span>  151.   3   canterbury racecou…  <span style="text-decoration: underline;">94</span>766  9.63 sydn… &lt;tibble&gt;</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> ASN00066124 -<span style="color: #BB0000;">33.8</span>  151.  55   parramatta north (…  <span style="text-decoration: underline;">94</span>764 19.4  sydn… &lt;tibble&gt;</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> ASN00066137 -<span style="color: #BB0000;">33.9</span>  151.   6.5 bankstown airport …  <span style="text-decoration: underline;">94</span>765 21.1  sydn… &lt;tibble&gt;</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> ASN00068192 -<span style="color: #BB0000;">34.0</span>  151.  73.9 camden airport aws   <span style="text-decoration: underline;">94</span>755 51.4  sydn… &lt;tibble&gt;</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> ASN00086038 -<span style="color: #BB0000;">37.7</span>  145.  78.4 essendon airport     <span style="text-decoration: underline;">95</span>866 10.8  melb… &lt;tibble&gt;</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> ASN00086282 -<span style="color: #BB0000;">37.7</span>  145. 113.  melbourne airport    <span style="text-decoration: underline;">94</span>866 20.1  melb… &lt;tibble&gt;</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> ASN00086077 -<span style="color: #BB0000;">38.0</span>  145.  12.1 moorabbin airport    <span style="text-decoration: underline;">94</span>870 21.9  melb… &lt;tibble&gt;</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> ASN00088162 -<span style="color: #BB0000;">37.4</span>  145. 528.  wallan (kilmore ga…  <span style="text-decoration: underline;">94</span>860 48.1  melb… &lt;tibble&gt;</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">10</span> ASN00087113 -<span style="color: #BB0000;">38.0</span>  144.  10.6 avalon airport       <span style="text-decoration: underline;">94</span>854 48.8  melb… &lt;tibble&gt;</span></code></pre></div>
<!-- # Before you go -->
<!-- Let's look at these stations on the map: -->
<!-- ```{r fig.width=10, fig.height=5, echo = FALSE} -->
<!-- syd_map <- absmapsdata::sa42016  %>% filter(gcc_name_2016 == "Greater Sydney") -->
<!-- mel_map <- absmapsdata::sa42016  %>% filter(gcc_name_2016 == "Greater Melbourne") -->
<!-- syd_station <- sydmel_climate %>% filter(city == "sydney") -->
<!-- mel_station <- sydmel_climate %>% filter(city == "melbourne") -->
<!-- p1 <-  plot_map(syd_map) + -->
<!--   ggrepel::geom_label_repel( -->
<!--     data = syd_station,  -->
<!--     aes(x = long, y = lat, label = name), -->
<!--     max.iter = 1e7, min.segment.length = 0.01, box.padding = 0.5) +  -->
<!--   geom_point(data = syd_station, aes(x = long, y = lat)) +  -->
<!--   theme_minimal() +  -->
<!--   theme(panel.grid.major = element_blank(), -->
<!--         panel.grid.minor = element_blank()) +  -->
<!--   ggtitle("Sydney") -->
<!-- p2 <- plot_map(mel_map) + -->
<!--   ggrepel::geom_label_repel( -->
<!--     data = mel_station,   -->
<!--     aes(x = long, y = lat, label = name),  -->
<!--     max.iter = 1e7, min.segment.length = 0.1) +  -->
<!--   geom_point(data = mel_station, aes(x = long, y = lat)) +  -->
<!--   theme_minimal() +  -->
<!--   theme(panel.grid.major = element_blank(), -->
<!--         panel.grid.minor = element_blank()) +  -->
<!--   ggtitle("Melbourne") -->
<!-- p1 | p2 -->
<!-- ``` -->
</div>
<div class="section level2">
<h2 id="a-cubble-from-tsibble">A cubble from tsibble<a class="anchor" aria-label="anchor" href="#a-cubble-from-tsibble"></a>
</h2>
<p>Suppose we have a tsibble from <code>climate_flat</code>:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dt</span> <span class="op">&lt;-</span> <span class="va">climate_flat</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
  <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/as-tsibble.html" class="external-link">as_tsibble</a></span><span class="op">(</span>key <span class="op">=</span> <span class="va">id</span>, index <span class="op">=</span> <span class="va">date</span><span class="op">)</span>
<span class="va">dt</span>
<span class="co">#&gt; <span style="color: #949494;"># A tsibble: 155 x 10 [1D]</span></span>
<span class="co">#&gt; <span style="color: #949494;"># Key:       id [5]</span></span>
<span class="co">#&gt;    id            lat  long  elev name        wmo_id date        prcp  tmax  tmin</span>
<span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> ASN00009021 -<span style="color: #BB0000;">31.9</span>  116.  15.4 perth airp…  <span style="text-decoration: underline;">94</span>610 2020-01-01     0  31.9  15.3</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> ASN00009021 -<span style="color: #BB0000;">31.9</span>  116.  15.4 perth airp…  <span style="text-decoration: underline;">94</span>610 2020-01-02     0  24.9  16.4</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> ASN00009021 -<span style="color: #BB0000;">31.9</span>  116.  15.4 perth airp…  <span style="text-decoration: underline;">94</span>610 2020-01-03     6  23.2  13  </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> ASN00009021 -<span style="color: #BB0000;">31.9</span>  116.  15.4 perth airp…  <span style="text-decoration: underline;">94</span>610 2020-01-04     0  28.4  12.4</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> ASN00009021 -<span style="color: #BB0000;">31.9</span>  116.  15.4 perth airp…  <span style="text-decoration: underline;">94</span>610 2020-01-05     0  35.3  11.6</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> ASN00009021 -<span style="color: #BB0000;">31.9</span>  116.  15.4 perth airp…  <span style="text-decoration: underline;">94</span>610 2020-01-06     0  34.8  13.1</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> ASN00009021 -<span style="color: #BB0000;">31.9</span>  116.  15.4 perth airp…  <span style="text-decoration: underline;">94</span>610 2020-01-07     0  32.8  15.1</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> ASN00009021 -<span style="color: #BB0000;">31.9</span>  116.  15.4 perth airp…  <span style="text-decoration: underline;">94</span>610 2020-01-08     0  30.4  17.4</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> ASN00009021 -<span style="color: #BB0000;">31.9</span>  116.  15.4 perth airp…  <span style="text-decoration: underline;">94</span>610 2020-01-09     0  28.7  17.3</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">10</span> ASN00009021 -<span style="color: #BB0000;">31.9</span>  116.  15.4 perth airp…  <span style="text-decoration: underline;">94</span>610 2020-01-10     0  32.6  15.8</span>
<span class="co">#&gt; <span style="color: #949494;"># … with 145 more rows</span></span></code></pre></div>
<p>We can create a cubble out of the tsibble only with the additional <code>coords</code> argument:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cb</span> <span class="op">&lt;-</span> <span class="va">dt</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="../reference/cubble-class.html">as_cubble</a></span><span class="op">(</span>coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">long</span>, <span class="va">lat</span><span class="op">)</span><span class="op">)</span>
<span class="va">cb</span>
<span class="co">#&gt; <span style="color: #949494;"># cubble:   id [5]: nested form</span></span>
<span class="co">#&gt; <span style="color: #949494;"># bbox:     [115.97, -32.94, 133.55, -12.42]</span></span>
<span class="co">#&gt; <span style="color: #949494;"># temporal: date [date], prcp [dbl], tmax [dbl], tmin [dbl]</span></span>
<span class="co">#&gt;   id            lat  long  elev name           wmo_id ts               </span>
<span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>           </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">1</span> ASN00009021 -<span style="color: #BB0000;">31.9</span>  116.  15.4 perth airport   <span style="text-decoration: underline;">94</span>610 <span style="color: #949494;">&lt;tbl_ts [31 × 4]&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;">2</span> ASN00010311 -<span style="color: #BB0000;">31.9</span>  117. 179   york            <span style="text-decoration: underline;">94</span>623 <span style="color: #949494;">&lt;tbl_ts [31 × 4]&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;">3</span> ASN00010614 -<span style="color: #BB0000;">32.9</span>  117. 338   narrogin        <span style="text-decoration: underline;">94</span>627 <span style="color: #949494;">&lt;tbl_ts [31 × 4]&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;">4</span> ASN00014015 -<span style="color: #BB0000;">12.4</span>  131.  30.4 darwin airport  <span style="text-decoration: underline;">94</span>120 <span style="color: #949494;">&lt;tbl_ts [31 × 4]&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;">5</span> ASN00015131 -<span style="color: #BB0000;">17.6</span>  134. 220   elliott         <span style="text-decoration: underline;">94</span>236 <span style="color: #949494;">&lt;tbl_ts [31 × 4]&gt;</span></span></code></pre></div>
<p>Notice here each element of the list-column  is a  class and you are free to apply your favourite function on the tsibble class :)</p>
</div>
<div class="section level2">
<h2 id="a-cubble-from-netcdf-data">A cubble from NetCDF data<a class="anchor" aria-label="anchor" href="#a-cubble-from-netcdf-data"></a>
</h2>
<p>NetCDF data may not be familiar to everyone and here we provide some background information on this data format. If you’re comfortable with NetCDF, feel free to skip the next few paragraphs.</p>
<p>NetCDF (Network Common Data Form) is a commonly used data format in the climatology community to deliver global mapping of atmosphere, ocean, and land. It has two main components:</p>
<ul>
<li>
<strong>dimension</strong>: define the spatio-temporal grid (longitude, latitude, and time) and</li>
<li>
<strong>variable</strong>: populate the defined grid.</li>
</ul>
<p>Attributes are usually associated with dimension and variable in the NetCDF format data. A few packages in R exists for manipulating NetCDF data and this includes a high-level R interface: <code>ncdf4</code>, a low-level interface that calls C interface: <code>RNetCDF</code>, and a tidyverse implementation: <code>tidync</code>. Here let’s take a look at a NetCDF data:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"ncdf/era5-pressure.nc"</span>, package <span class="op">=</span> <span class="st">"weatherdata"</span><span class="op">)</span>
<span class="va">raw</span> <span class="op">&lt;-</span> <span class="fu">ncdf4</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ncdf4/man/nc_open.html" class="external-link">nc_open</a></span><span class="op">(</span><span class="va">path</span><span class="op">)</span>
<span class="va">raw</span>
<span class="co">#&gt; File /Users/runner/work/_temp/Library/weatherdata/ncdf/era5-pressure.nc (NC_FORMAT_64BIT):</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;      2 variables (excluding dimension variables):</span>
<span class="co">#&gt;         short q[longitude,latitude,time]   </span>
<span class="co">#&gt;             scale_factor: 2.31369967378219e-11</span>
<span class="co">#&gt;             add_offset: 3.14279193871837e-06</span>
<span class="co">#&gt;             _FillValue: -32767</span>
<span class="co">#&gt;             missing_value: -32767</span>
<span class="co">#&gt;             units: kg kg**-1</span>
<span class="co">#&gt;             long_name: Specific humidity</span>
<span class="co">#&gt;             standard_name: specific_humidity</span>
<span class="co">#&gt;         short z[longitude,latitude,time]   </span>
<span class="co">#&gt;             scale_factor: 0.689844238780462</span>
<span class="co">#&gt;             add_offset: 292466.311327881</span>
<span class="co">#&gt;             _FillValue: -32767</span>
<span class="co">#&gt;             missing_value: -32767</span>
<span class="co">#&gt;             units: m**2 s**-2</span>
<span class="co">#&gt;             long_name: Geopotential</span>
<span class="co">#&gt;             standard_name: geopotential</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;      3 dimensions:</span>
<span class="co">#&gt;         longitude  Size:1440 </span>
<span class="co">#&gt;             units: degrees_east</span>
<span class="co">#&gt;             long_name: longitude</span>
<span class="co">#&gt;         latitude  Size:341 </span>
<span class="co">#&gt;             units: degrees_north</span>
<span class="co">#&gt;             long_name: latitude</span>
<span class="co">#&gt;         time  Size:8 </span>
<span class="co">#&gt;             units: hours since 1900-01-01 00:00:00.0</span>
<span class="co">#&gt;             long_name: time</span>
<span class="co">#&gt;             calendar: gregorian</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     2 global attributes:</span>
<span class="co">#&gt;         Conventions: CF-1.6</span>
<span class="co">#&gt;         history: 2022-02-02 04:55:36 GMT by grib_to_netcdf-2.23.0: /opt/ecmwf/mars-client/bin/grib_to_netcdf -S param -o /cache/data4/adaptor.mars.internal-1643777736.4793415-16663-1-adf4268d-b7b7-4494-868b-6cb57305d6f9.nc /cache/tmp/adf4268d-b7b7-4494-868b-6cb57305d6f9-adaptor.mars.internal-1643777732.7619627-16663-1-tmp.grib</span></code></pre></div>
<p>In a NetCDF data, it is not the the actual data that gets directly printed out, but the metadata. There are 2 variables and 3 dimensions in this data and each is associated with a few attributes. In this data the attributes for the two variables includes the scaling and offset parameter, representation of the missing and its fill value, along with its unit and names. In NetCDF, data is stored in its <em>packed value</em> to save space and sometimes, you will need to use a formula like <span class="math inline">\(\text{unpacked value} = \text{packed value} \times \text{scale factor} + \text{add offset}\)</span> to unpack the data. Luckily, when reading in the NetCDF data with the <code>ncdf4</code> package, it has already unpack the data for you, so no need to worry about the scaling and offset.</p>
<p>In principle, NetCDF data can store data with arbitrary variable, dimension, and attribute and this will cause a chaos to generalise its manipulation. <a href="http://cfconventions.org/" class="external-link">Metadata convention for climate and forecast (CF convention)</a> is a guideline that has been designed to standardise the format of NetCDF data. Thanks to the CF convention, <code>cubble</code> can now extract specific components as per the CF convention to build a cubble from NetCDF data. Cubble provides an <code><a href="../reference/cubble-class.html">as_cubble()</a></code> method to coerce the <code>ncdf4</code> class from the <code>ncdf4</code> package into a cubble. It maps each combination of longitude and latitude into an <code>id</code> as the key:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dt</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cubble-class.html">as_cubble</a></span><span class="op">(</span><span class="va">raw</span>, vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"q"</span>, <span class="st">"z"</span><span class="op">)</span><span class="op">)</span>
<span class="va">dt</span>
<span class="co">#&gt; <span style="color: #949494;"># cubble:   id [491040]: nested form</span></span>
<span class="co">#&gt; <span style="color: #949494;"># bbox:     [-180, -90, 179.75, -5]</span></span>
<span class="co">#&gt; <span style="color: #949494;"># temporal: time [dttm], q [dbl], z [dbl]</span></span>
<span class="co">#&gt;       id  long   lat ts              </span>
<span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>          </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>     1 -<span style="color: #BB0000;">180</span>     -<span style="color: #BB0000;">5</span> <span style="color: #949494;">&lt;tibble [8 × 3]&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>     2 -<span style="color: #BB0000;">180.</span>    -<span style="color: #BB0000;">5</span> <span style="color: #949494;">&lt;tibble [8 × 3]&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>     3 -<span style="color: #BB0000;">180.</span>    -<span style="color: #BB0000;">5</span> <span style="color: #949494;">&lt;tibble [8 × 3]&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>     4 -<span style="color: #BB0000;">179.</span>    -<span style="color: #BB0000;">5</span> <span style="color: #949494;">&lt;tibble [8 × 3]&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>     5 -<span style="color: #BB0000;">179</span>     -<span style="color: #BB0000;">5</span> <span style="color: #949494;">&lt;tibble [8 × 3]&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>     6 -<span style="color: #BB0000;">179.</span>    -<span style="color: #BB0000;">5</span> <span style="color: #949494;">&lt;tibble [8 × 3]&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>     7 -<span style="color: #BB0000;">178.</span>    -<span style="color: #BB0000;">5</span> <span style="color: #949494;">&lt;tibble [8 × 3]&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>     8 -<span style="color: #BB0000;">178.</span>    -<span style="color: #BB0000;">5</span> <span style="color: #949494;">&lt;tibble [8 × 3]&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>     9 -<span style="color: #BB0000;">178</span>     -<span style="color: #BB0000;">5</span> <span style="color: #949494;">&lt;tibble [8 × 3]&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;">10</span>    10 -<span style="color: #BB0000;">178.</span>    -<span style="color: #BB0000;">5</span> <span style="color: #949494;">&lt;tibble [8 × 3]&gt;</span></span>
<span class="co">#&gt; <span style="color: #949494;"># … with 491,030 more rows</span></span></code></pre></div>
<p>The memory limit with NetCDF data in cubble depends on longitude grid point x latitude grid point x time grid point x number of variable. Cubble can handle slightly more than 300 x 300 (longitude x longitude) grid points for 3 variables in one year. You can reduce the spatial grid points in exchange for longer time period and more variables. A 300 by 300 spatial grid can be:</p>
<ul>
<li>a bounding box of [100, -80, 180, 0] at 0.25 degree resolution, or</li>
<li>a global bounding box [-180, -90, 180, -90] at 1 degree resolution.</li>
</ul>
<p>Subsetting longitude and latitude grid is available through <code>long_range</code> and <code>lat_range</code> if the NetCDF file has finer resolution than needed.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dt</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cubble-class.html">as_cubble</a></span><span class="op">(</span><span class="va">raw</span>, vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"q"</span>, <span class="st">"z"</span><span class="op">)</span>,
                long_range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">180</span>, <span class="fl">180</span>, <span class="fl">1</span><span class="op">)</span>,
                lat_rnage <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">90</span>, <span class="op">-</span><span class="fl">5</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span>
<span class="va">dt</span>
<span class="co">#&gt; <span style="color: #949494;"># cubble:   id [122760]: nested form</span></span>
<span class="co">#&gt; <span style="color: #949494;"># bbox:     [-180, -90, 179, -5]</span></span>
<span class="co">#&gt; <span style="color: #949494;"># temporal: time [dttm], q [dbl], z [dbl]</span></span>
<span class="co">#&gt;       id  long   lat ts              </span>
<span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>          </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>     1  -<span style="color: #BB0000;">180</span>    -<span style="color: #BB0000;">5</span> <span style="color: #949494;">&lt;tibble [8 × 3]&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>     2  -<span style="color: #BB0000;">179</span>    -<span style="color: #BB0000;">5</span> <span style="color: #949494;">&lt;tibble [8 × 3]&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>     3  -<span style="color: #BB0000;">178</span>    -<span style="color: #BB0000;">5</span> <span style="color: #949494;">&lt;tibble [8 × 3]&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>     4  -<span style="color: #BB0000;">177</span>    -<span style="color: #BB0000;">5</span> <span style="color: #949494;">&lt;tibble [8 × 3]&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>     5  -<span style="color: #BB0000;">176</span>    -<span style="color: #BB0000;">5</span> <span style="color: #949494;">&lt;tibble [8 × 3]&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>     6  -<span style="color: #BB0000;">175</span>    -<span style="color: #BB0000;">5</span> <span style="color: #949494;">&lt;tibble [8 × 3]&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>     7  -<span style="color: #BB0000;">174</span>    -<span style="color: #BB0000;">5</span> <span style="color: #949494;">&lt;tibble [8 × 3]&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>     8  -<span style="color: #BB0000;">173</span>    -<span style="color: #BB0000;">5</span> <span style="color: #949494;">&lt;tibble [8 × 3]&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>     9  -<span style="color: #BB0000;">172</span>    -<span style="color: #BB0000;">5</span> <span style="color: #949494;">&lt;tibble [8 × 3]&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;">10</span>    10  -<span style="color: #BB0000;">171</span>    -<span style="color: #BB0000;">5</span> <span style="color: #949494;">&lt;tibble [8 × 3]&gt;</span></span>
<span class="co">#&gt; <span style="color: #949494;"># … with 122,750 more rows</span></span></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by H. Sherry Zhang, Dianne Cook, Ursula Laa, Nicolas Langrené, Patricia Menéndez.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.2.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
