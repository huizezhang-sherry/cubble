<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>4. Matching different data sources • cubble</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="4. Matching different data sources">
<meta property="og:description" content="cubble">
<meta property="og:image" content="/logo.svg">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">cubble</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.3.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/cubble.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/cb1class.html">1. The cubble class</a>
    </li>
    <li>
      <a href="../articles/cb2create.html">2. Creation and coercion</a>
    </li>
    <li>
      <a href="../articles/cb3glyph.html">3. Making a glyph map</a>
    </li>
    <li>
      <a href="../articles/cb4match.html">4. Matching different data sources</a>
    </li>
    <li>
      <a href="../articles/cb5interactive.html">5. Interactive graphics</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/huizezhang-sherry/cubble/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>4. Matching different data sources</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/huizezhang-sherry/cubble/blob/HEAD/vignettes/cb4match.Rmd" class="external-link"><code>vignettes/cb4match.Rmd</code></a></small>
      <div class="hidden name"><code>cb4match.Rmd</code></div>

    </div>

    
    
<p>One common type of task with spatio-temporal data is to match nearby
sites. For example, we may want to verify the location of an old list of
stations with current stations, or we may want to match the data from
different data sources. Some of these matches only concern the spatial
dimension, while others require temporal agreement.</p>
<p>This vignette introduces how to spatially and spatio-temporally match
sites with the cubble structure with two examples. The first example
pairs traditional weather stations with nearby automated stations in New
South Wales, Australia. This exercise only concerns the matching based
on spherical distance between stations. The next example pairs the river
level recorded by the river gauges with the precipitation recorded by
the nearby weather station in Victoria, Australia.</p>
<div class="section level2">
<h2 id="spatial-matching">Spatial matching<a class="anchor" aria-label="anchor" href="#spatial-matching"></a>
</h2>
<p>Bureau of Meteorology collects <a href="http://www.bom.gov.au/metadata/catalogue/19115/ANZCW0503900528?template=full" class="external-link">water
data</a> from river gauges and this includes variables: electrical
conductivity, turbidity, water course discharge, water course level, and
water temperature. In particular, water level will interactive with
precipitation from the climate data since rainfall will raise the water
level in the river. Here is the location of available weather station
and water gauges in Victoria:</p>
<p><img src="cb4match_files/figure-html/unnamed-chunk-2-1.png" width="100%"></p>
<p>In cubble, <code><a href="../reference/matching.html">match_sites()</a></code> houses
<code><a href="../reference/matching.html">match_spatial()</a></code> and <code><a href="../reference/matching.html">match_temporal()</a></code>. For a
spatial-only matching, you can use
<code>match_sites(temporal_matching = FALSE)</code> or simply
<code><a href="../reference/matching.html">match_spatial()</a></code>.</p>
<p>Any matching requires two datasets in the cubble and we call them
<code>major</code> and <code>minor</code>. Major and minor dataset
differs from how distance is calculated. Spatial matching calculates the
spherical distance using the Vincenty formula and this distance is
calculated from <em>each</em> site in the <code>major</code> dataset is
to <em>every</em> site in the <code>minor</code> dataset.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">res_sp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/matching.html">match_spatial</a></span><span class="op">(</span><span class="va">climate_vic</span>, <span class="va">river</span>, </span>
<span>                        spatial_n_group <span class="op">=</span> <span class="fl">10</span>, return_cubble <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="op">(</span><span class="va">res_sp</span> <span class="op">&lt;-</span> <span class="va">res_sp</span><span class="op">[</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">8</span><span class="op">)</span><span class="op">]</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># cubble:   key: id [16], index: date, nested form, [sf]</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># spatial:  [144.5203, -38.144913, 148.4667, -36.128657], WGS 84</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># temporal: date [date], prcp [dbl], tmax [dbl], tmin [dbl]</span></span></span>
<span><span class="co">#&gt;    id     long   lat  elev name  wmo_id ts       type              geometry</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;POINT [°]&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> ASN0…  145. -<span style="color: #BB0000;">37.0</span> 290   rede…  <span style="text-decoration: underline;">94</span>859 <span style="color: #949494;">&lt;tibble&gt;</span> clim…  (144.5203 -37.0194)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 4062…  145. -<span style="color: #BB0000;">37.0</span>  <span style="color: #BB0000;">NA</span>   CAMP…     <span style="color: #BB0000;">NA</span> <span style="color: #949494;">&lt;tibble&gt;</span> rive… (144.5403 -37.01512)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> ASN0…  148. -<span style="color: #BB0000;">37.7</span>  62.7 orbo…  <span style="text-decoration: underline;">95</span>918 <span style="color: #949494;">&lt;tibble&gt;</span> clim…  (148.4667 -37.6922)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 2222…  148. -<span style="color: #BB0000;">37.7</span>  <span style="color: #BB0000;">NA</span>   SNOW…     <span style="color: #BB0000;">NA</span> <span style="color: #949494;">&lt;tibble&gt;</span> rive…  (148.451 -37.70739)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> ASN0…  147. -<span style="color: #BB0000;">38.1</span>   4.6 east…  <span style="text-decoration: underline;">94</span>907 <span style="color: #949494;">&lt;tibble&gt;</span> clim…  (147.1322 -38.1156)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 2260…  147. -<span style="color: #BB0000;">38.1</span>  <span style="color: #BB0000;">NA</span>   LA T…     <span style="color: #BB0000;">NA</span> <span style="color: #949494;">&lt;tibble&gt;</span> rive… (147.1278 -38.14491)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> ASN0…  145. -<span style="color: #BB0000;">36.2</span>  96   echu…  <span style="text-decoration: underline;">94</span>861 <span style="color: #949494;">&lt;tibble&gt;</span> clim…  (144.7642 -36.1647)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 4067…  145. -<span style="color: #BB0000;">36.1</span>  <span style="color: #BB0000;">NA</span>   DEAK…     <span style="color: #BB0000;">NA</span> <span style="color: #949494;">&lt;tibble&gt;</span> rive… (144.7693 -36.12866)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> ASN0…  146. -<span style="color: #BB0000;">36.8</span> 502   stra…  <span style="text-decoration: underline;">95</span>843 <span style="color: #949494;">&lt;tibble&gt;</span> clim…  (145.7308 -36.8472)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 4052…  146. -<span style="color: #BB0000;">36.9</span>  <span style="color: #BB0000;">NA</span>   SEVE…     <span style="color: #BB0000;">NA</span> <span style="color: #949494;">&lt;tibble&gt;</span> rive… (145.6828 -36.88701)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">11</span> ASN0…  145. -<span style="color: #BB0000;">37.7</span>  78.4 esse…  <span style="text-decoration: underline;">95</span>866 <span style="color: #949494;">&lt;tibble&gt;</span> clim…  (144.9066 -37.7276)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">12</span> 2302…  145. -<span style="color: #BB0000;">37.7</span>  <span style="color: #BB0000;">NA</span>   MARI…     <span style="color: #BB0000;">NA</span> <span style="color: #949494;">&lt;tibble&gt;</span> rive… (144.8365 -37.72771)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">13</span> ASN0…  148. -<span style="color: #BB0000;">37.9</span>  49.4 bair…  <span style="text-decoration: underline;">94</span>912 <span style="color: #949494;">&lt;tibble&gt;</span> clim…  (147.5669 -37.8817)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">14</span> 2242…  148. -<span style="color: #BB0000;">37.8</span>  <span style="color: #BB0000;">NA</span>   MITC…     <span style="color: #BB0000;">NA</span> <span style="color: #949494;">&lt;tibble&gt;</span> rive…   (147.5722 -37.815)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">15</span> ASN0…  145. -<span style="color: #BB0000;">36.3</span> 105   kyab…  <span style="text-decoration: underline;">95</span>833 <span style="color: #949494;">&lt;tibble&gt;</span> clim…   (145.0638 -36.335)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">16</span> 4067…  145. -<span style="color: #BB0000;">36.3</span>  <span style="color: #BB0000;">NA</span>   MOSQ…     <span style="color: #BB0000;">NA</span> <span style="color: #949494;">&lt;tibble&gt;</span> rive… (144.9809 -36.32871)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 2 more variables: group &lt;int&gt;, dist [m]</span></span></span></code></pre></div>
<p>Once the distance is calculated, three arguments are available to
refine the matching results:</p>
<ul>
<li>
<code>spatial_n_keep</code>: Number of match each major site
receive</li>
<li>
<code>spatial_dist_max</code>: maximum distance allowed for a pair
of matching</li>
<li>
<code>spatial_single_match</code>: Whether each minor site can only
be matched to one major site</li>
</ul>
<p>The order that these three arguments applied will slightly affect the
results in <code>cubble</code>. <code>spatial_n_keep</code>, default to
1, is first applied to keep <code>n</code> site(s) for each major site,
<code>spaital_dist_max</code>, default to 10, is then applied to filter
out the pairs with distance larger than this maximum distance.
<code>spatial_single_match</code> is lastly applied to resolve the
scenario where site <code>a</code> (minor) is the closest match for both
site <code>A</code> and <code>B</code> (major) with distance 5km and
8km. If <code>spatial_single_match = TRUE</code>, <code>a</code> will
only be matched to the major site with the smaller distance, that is,
site <code>A</code> here.</p>
</div>
<div class="section level2">
<h2 id="temporal-matching">Temporal matching<a class="anchor" aria-label="anchor" href="#temporal-matching"></a>
</h2>
<p>Here we provide more details on how temporal matching works in
<code>cubble</code>. Suppose two locations have been matched spatially
and temporal matching will be conducted on variable <code>A</code> and
<code>a</code> in the plot below: .</p>
<p>We first find the <code>n</code> peaks in each series (3 peaks here).
A variable needs to be specified in <code>temporal_independent</code>
for construct an interval. Here we pick variable <code>A</code> and
construct an interval with a default length of 5. The peaks in variable
<code>a</code> are then tested against whether they fall into the any of
the intervals constructed from <code>A</code>. In this illustration,
there are 2 matches for these two variable The available tuning
parameter in temporal matches are:</p>
<ul>
<li>
<code>temporal_n_highest</code>: the number of peak used - 3 in the
example above</li>
<li>
<code>temporal_window</code>: the length of the interval - 5 in the
example above</li>
<li>
<code>temporal_min_match</code>: the minimum number of matched peak
for a valid matched pair. To return all the pairs of the match, set this
parameter to 0.</li>
</ul>
<p>In the river level and precipitation example,
<code>Water_course_level</code> in <code>river</code> will be matched to
<code>prcp</code> in <code>climate</code>. This can be specified in
<code>temporal_by</code>, an analogue to the <code>by</code> syntax in
<code>join</code>. The goal in this example is to see if precipitation
will be reflected by the water level in the river and this puts
precipitation <code>prcp</code>, as the independent. Given there is one
year worth of data, the number of peak (<code>temporal_n_highest</code>)
to consider is slightly raised from a default 20 to 30 and
<code>temporal_min_match</code> is raised accordingly.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">res_tm</span> <span class="op">&lt;-</span> <span class="va">res_sp</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/matching.html">match_temporal</a></span><span class="op">(</span></span>
<span>    data_id <span class="op">=</span> <span class="va">type</span>,</span>
<span>    match_id <span class="op">=</span> <span class="va">group</span>,</span>
<span>    return_cubble <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    temporal_by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"prcp"</span> <span class="op">=</span> <span class="st">"Water_course_level"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">res_tm</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># cubble:   key: id [2], index: date, nested form, [sf]</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># spatial:  [144.5203, -37.0194, 144.540295, -37.015122], WGS 84</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># temporal: date [date], matched [dbl]</span></span></span>
<span><span class="co">#&gt;   id         long   lat  elev name  wmo_id type              geometry group</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;POINT [°]&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> ASN00088…  145. -<span style="color: #BB0000;">37.0</span>   290 rede…  <span style="text-decoration: underline;">94</span>859 clim…  (144.5203 -37.0194)     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 406213     145. -<span style="color: #BB0000;">37.0</span>    <span style="color: #BB0000;">NA</span> CAMP…     <span style="color: #BB0000;">NA</span> rive… (144.5403 -37.01512)     1</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 3 more variables: dist [m], ts &lt;list&gt;, match_res &lt;dbl&gt;</span></span></span></code></pre></div>
<p>The output from temporal matching is also a cubble with
<code>n_match</code> for the number of matched temporal peaks (on top of
the <code>dist</code> and <code>group</code> from spatial
matching)：</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">res_tm</span> <span class="op">&lt;-</span> <span class="va">res_tm</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">group</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">7</span>, <span class="fl">6</span>, <span class="fl">9</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>We can look at the matched pair on the map:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">vic_map</span> <span class="op">&lt;-</span> <span class="fu">ozmaps</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/ozmaps/man/abs-data.html" class="external-link">abs_ste</a></span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">NAME</span> <span class="op">==</span> <span class="st">"Victoria"</span><span class="op">)</span> </span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">vic_map</span>, fill <span class="op">=</span> <span class="st">"grey95"</span>, color <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">river</span>, <span class="va">climate_vic</span><span class="op">)</span>, </span>
<span>             <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">long</span>, y <span class="op">=</span> <span class="va">lat</span>, color <span class="op">=</span> <span class="va">type</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.2</span>, fill <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">res_tm</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="op">)</span> , <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">long</span>, y <span class="op">=</span> <span class="va">lat</span>, color <span class="op">=</span> <span class="va">type</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggrepel</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ggrepel/man/geom_text_repel.html" class="external-link">geom_label_repel</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">res_tm</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">type</span> <span class="op">==</span> <span class="st">"river"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="op">)</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">long</span>, y <span class="op">=</span> <span class="va">lat</span>, label <span class="op">=</span> <span class="va">group</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html" class="external-link">scale_color_brewer</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Dark2"</span><span class="op">)</span>  <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span>,</span>
<span>                 legend.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">15</span><span class="op">)</span>,</span>
<span>                 legend.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">15</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Longitude"</span>, y <span class="op">=</span> <span class="st">"Latitude"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>color <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html" class="external-link">guide_legend</a></span><span class="op">(</span>override.aes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">5</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="cb4match_files/figure-html/unnamed-chunk-6-1.png" width="100%"></p>
<p>or to look at the series:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">res_tm_long</span> <span class="op">&lt;-</span> <span class="va">res_tm</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>  </span>
<span>  <span class="fu"><a href="../reference/face.html">face_temporal</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>  </span>
<span>  <span class="fu"><a href="../reference/unfold.html">unfold</a></span><span class="op">(</span><span class="va">group</span>, <span class="va">type</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>  </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>prcp <span class="op">=</span> <span class="va">matched</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>  </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">group</span>, <span class="va">type</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>prcp <span class="op">=</span> <span class="op">(</span><span class="va">prcp</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">prcp</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span><span class="op">/</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">prcp</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">prcp</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">res_tm_long</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>  </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date</span>, y <span class="op">=</span> <span class="va">prcp</span>, group <span class="op">=</span> <span class="va">type</span>,color <span class="op">=</span> <span class="va">type</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">group</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html" class="external-link">scale_color_brewer</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Dark2"</span>, guide <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x<span class="op">=</span>  <span class="st">"date"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_date.html" class="external-link">scale_x_date</a></span><span class="op">(</span>date_labels <span class="op">=</span> <span class="st">"%b"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Week"</span>, y <span class="op">=</span> <span class="st">"Precipitation/ water level"</span><span class="op">)</span></span></code></pre></div>
<p><img src="cb4match_files/figure-html/unnamed-chunk-7-1.png" width="100%"></p>
<p>There are four pairs of matches - all locates in the middle Victoria
and we can observe concurrent increase of precipitation and water level
(precipitation and water level have been standardised between 0 and 1 to
be displayed on the same scale).</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by H. Sherry Zhang, Dianne Cook, Ursula Laa, Nicolas Langrené, Patricia Menéndez.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
