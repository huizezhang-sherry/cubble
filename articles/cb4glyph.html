<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>4. Making a glyph map • cubble</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="4. Making a glyph map">
<meta property="og:description" content="cubble">
<meta property="og:image" content="/logo.svg">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">cubble</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.3.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/cubble.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/cb1class.html">1. The cubble class</a>
    </li>
    <li>
      <a href="../articles/cb2create.html">2. Creation and coercion</a>
    </li>
    <li>
      <a href="../articles/cb3tsibblesf.html">3. Compatibility with tsibble and sf</a>
    </li>
    <li>
      <a href="../articles/cb4glyph.html">4. Making a glyph map</a>
    </li>
    <li>
      <a href="../articles/cb5match.html">5. Matching different data sources</a>
    </li>
    <li>
      <a href="../articles/cb6interactive.html">6. Interactive graphics</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/huizezhang-sherry/cubble/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>4. Making a glyph map</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/huizezhang-sherry/cubble/blob/HEAD/vignettes/cb4glyph.Rmd" class="external-link"><code>vignettes/cb4glyph.Rmd</code></a></small>
      <div class="hidden name"><code>cb4glyph.Rmd</code></div>

    </div>

    
    
<p>Sometimes, we wish to communicate spatial and temporal information
collectively through visualisation. This can be done through making
faceted maps across time, creating map animation, or in interactive
graphics, constructing linking between maps and time series plot.</p>
<p>This vignette will introduce a type of spatio-temporal plot, glyph
map, which displays spatial and temporal information in a single plot
using linear algebra.</p>
<div class="section level2">
<h2 id="what-is-a-glyph-map">What is a glyph map?<a class="anchor" aria-label="anchor" href="#what-is-a-glyph-map"></a>
</h2>
<p>Glyph maps are initially proposed in <span class="citation">Wickham
et al. (2012)</span> and the idea is to transform the temporal
coordinates into the spatial coordinates so that time series plot can be
displayed on the map. The following diagram illustrates how the
transformation works:</p>
<p><img src="cluster-diagram/glyph-steps.png" width="100%"></p>
<p>Subplot (1) and (2) show the location of a weather station and its
associated maximum temperature in 2020. In (3), the same time series is
transformed into the spatial coordinates with a defined
<code>height</code> and <code>width</code> using linear algebra
(Equation 1 in <span class="citation">Wickham et al. (2012)</span>). The
transformed time series can then be placed on the map in (4). A polar
transformation (Equation 2 in <span class="citation">Wickham et al.
(2012)</span>) is also available with wrap the time series plot into a
circle and it is useful to visualise seasonality.</p>
<p>The package <code>GGally</code> initially implement the glyph map. It
uses <code>glyphs()</code> to calculate the axis transformation and then
uses <code><a href="https://ggplot2.tidyverse.org/reference/geom_polygon.html" class="external-link">geom_polygon()</a></code> to draw the map.</p>
<pre><code><span><span class="va">gly</span> <span class="op">&lt;-</span> <span class="fu">glyphs</span><span class="op">(</span><span class="va">data</span>, x_major <span class="op">=</span> <span class="va">...</span>, x_minor <span class="op">=</span> <span class="va">...</span>, y_major <span class="op">=</span> <span class="va">...</span>, y_minor <span class="op">=</span> <span class="va">...</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># `gx`, `gy`, and `gid` are created within `glyphs()`</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">gly</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">gx</span>, <span class="va">gy</span>, group <span class="op">=</span> <span class="va">gid</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_path</a></span><span class="op">(</span><span class="op">)</span></span></code></pre>
<p>Four variables are required to construct a glyph map:
<code>x_major</code>, <code>y_major</code>, <code>x_minor</code>, and
<code>y_minor</code>. The major axes are the coordinates used to create
the map and in the illustration above
<code>x_major = long, y_major = lat</code>. The minor axes are the x/y
variable used to construct the time series
plot(<code>x_minor = date, y_minor = tmax</code> in above).</p>
</div>
<div class="section level2">
<h2 id="glyph-map-in-cubble">Glyph map in cubble<a class="anchor" aria-label="anchor" href="#glyph-map-in-cubble"></a>
</h2>
<p>The <code>cubble</code> package implements the glyph map in a
<code><a href="../reference/glyph.html">geom_glyph()</a></code>, which perform the linear algebra internally
as data transformation before the plot rendering. This allows you to use
the conventionally <code><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes()</a></code> syntax within
<code><a href="../reference/glyph.html">geom_glyph()</a></code> to specify the four major/minor axes:</p>
<pre><code><span><span class="va">data</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/glyph.html">geom_glyph</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x_major <span class="op">=</span> <span class="va">...</span>, x_minor <span class="op">=</span> <span class="va">...</span>, y_major <span class="op">=</span> <span class="va">...</span>, y_minor <span class="op">=</span> <span class="va">...</span><span class="op">)</span><span class="op">)</span></span></code></pre>
<p>Reference line and box can be added by separate geoms
(<code><a href="../reference/glyph.html">geom_glyph_box()</a></code>, <code><a href="../reference/glyph.html">geom_glyph_line()</a></code>) with the
same aesthetics (<code>x_major, x_minor, y_major, y_minor</code>) and to
avoid repetition, you may want specify them collectively in
<code><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot()</a></code>:</p>
<pre><code><span><span class="va">data</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x_major <span class="op">=</span> <span class="va">...</span>, x_minor <span class="op">=</span> <span class="va">...</span>, y_major <span class="op">=</span> <span class="va">...</span>, y_minor <span class="op">=</span> <span class="va">...</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/glyph.html">geom_glyph_box</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="../reference/glyph.html">geom_glyph_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="../reference/glyph.html">geom_glyph</a></span><span class="op">(</span><span class="op">)</span></span></code></pre>
<p>If you want add additional layer to the plot, i.e. an undelying map,
that does not use the four glyph map aesthetics, the argument
<code>inherit.aes = FALSE</code> is handy:</p>
<pre><code><span><span class="va">data</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x_major <span class="op">=</span> <span class="va">...</span>, x_minor <span class="op">=</span> <span class="va">...</span>, y_major <span class="op">=</span> <span class="va">...</span>, y_minor <span class="op">=</span> <span class="va">...</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">MAP_DATA</span>, inherit.aes <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="../reference/glyph.html">geom_glyph_box</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="../reference/glyph.html">geom_glyph_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="../reference/glyph.html">geom_glyph</a></span><span class="op">(</span><span class="op">)</span></span></code></pre>
<p>Taking the output from the <a href="cubble.html">Get started</a>
page, we can visualise the different in average temperature curve
between 1971 - 1975 and 2016 - 2020 using the glyph map:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">vic_map</span> <span class="op">&lt;-</span> <span class="fu">ozmaps</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/ozmaps/man/abs-data.html" class="external-link">abs_ste</a></span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">NAME</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Victoria"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">df</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x_major <span class="op">=</span> <span class="va">long</span>, y_major <span class="op">=</span> <span class="va">lat</span>, </span>
<span>             x_minor <span class="op">=</span> <span class="va">month</span>, y_minor <span class="op">=</span> <span class="va">tmax</span><span class="op">)</span><span class="op">)</span>  <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">vic_map</span>, </span>
<span>          fill <span class="op">=</span> <span class="st">"grey95"</span>, color <span class="op">=</span> <span class="st">"white"</span>,</span>
<span>          inherit.aes <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="../reference/glyph.html">geom_glyph_box</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">0.3</span>, height <span class="op">=</span> <span class="fl">0.08</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="../reference/glyph.html">geom_glyph</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">0.3</span>, height <span class="op">=</span> <span class="fl">0.08</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html" class="external-link">scale_color_brewer</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Dark2"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">coord_sf</a></span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">141</span>, <span class="fl">150</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Longitude"</span>, y <span class="op">=</span> <span class="st">"Latitude"</span><span class="op">)</span></span></code></pre></div>
<p><img src="cb4glyph_files/figure-html/unnamed-chunk-4-1.png" width="100%"></p>
</div>
<div class="section level2">
<h2 class="unnumbered" id="reference">Reference<a class="anchor" aria-label="anchor" href="#reference"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-Wickham2012-yr" class="csl-entry">
Wickham, Hadley, Heike Hofmann, Charlotte Wickham, and Dianne Cook.
2012. <span>“Glyph-Maps for Visually Exploring Temporal Patterns in
Climate Data and Models.”</span> <em>Environmetrics</em> 23 (5): 382–93.
<a href="https://doi.org/10.1002/env.2152" class="external-link">https://doi.org/10.1002/env.2152</a>.
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by H. Sherry Zhang, Dianne Cook, Ursula Laa, Nicolas Langrené, Patricia Menéndez.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
