<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>2. Data manipulation with cubble • cubble</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="2. Data manipulation with cubble">
<meta property="og:description" content="cubble">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">cubble</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.0.1.0000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/0-create-cubble-from-wild.html">0. Creating a cubble from data in the wild</a>
    </li>
    <li>
      <a href="../articles/1-details-on-cubble-design.html">1. details-on-cubble-design</a>
    </li>
    <li>
      <a href="../articles/2-data-manip-with-cubble.html">2. Data manipulation with cubble</a>
    </li>
    <li>
      <a href="../articles/3-application-automated-stations.html">3. Application: Matching nearby stations</a>
    </li>
    <li>
      <a href="../articles/4-spatial-temporal-aggregation.html">4. Application: Spatial and temporal aggregation</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="2-data-manip-with-cubble_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>2. Data manipulation with cubble</h1>
            
      
      
      <div class="hidden name"><code>2-data-manip-with-cubble.Rmd</code></div>

    </div>

    
    
<p>This vignette introduces how to perform spatial and temporal manipulate in a cubble with dplyr verbs. We will illustrate with an example that compares the maximum temperature in two periods: 1971 - 1975 and 2016 - 2020 for stations in Victoria and New South Wales.</p>
<div class="section level2">
<h2 id="spatial-manipulation">Spatial manipulation<a class="anchor" aria-label="anchor" href="#spatial-manipulation"></a>
</h2>
<p>The historical maximum temperature data is available in a nested cubble as <code>weatherdata::historical_tmax</code>. The data have recording for all the stations from 1969 with the longest date back to 1859.</p>
<p>Victoria and New South Wales stations can be subset by the station number: Australia GHCN station number starts with “ASN00” and followed by the <a href="http://www.bom.gov.au/climate/cdo/about/site-num.shtml" class="external-link">Bureau of Meteorology (BOM) station number</a>, where the 2nd and 3rd digit (7th and 8th in the GHCN number) define the state of the station. New South Wales stations start from 46 to 75 and Victoria stations follow from 76 to 90. Filtering Victoria and New South Wales stations is an operation in the spatial dimension and hence uses the nested form:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tmax</span> <span class="op">&lt;-</span> <span class="fu">weatherdata</span><span class="fu">::</span><span class="va">historical_tmax</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/between.html" class="external-link">between</a></span><span class="op">(</span><span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_sub.html" class="external-link">str_sub</a></span><span class="op">(</span><span class="va">id</span>, <span class="fl">7</span>, <span class="fl">8</span><span class="op">)</span>, <span class="fl">76</span>, <span class="fl">90</span><span class="op">)</span><span class="op">)</span>

<span class="va">tmax</span>
<span class="co">#&gt; <span style="color: #949494;"># cubble:   id [24]: nested form</span></span>
<span class="co">#&gt; <span style="color: #949494;"># bbox:     [142, -39.13, 149.92, -34.23]</span></span>
<span class="co">#&gt; <span style="color: #949494;"># temporal: date [date], tmax [dbl]</span></span>
<span class="co">#&gt;    id     latitude longitude elevation name  wmo_id element first_year last_year</span>
<span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> ASN00…    -<span style="color: #BB0000;">34.2</span>      142.      50   mild…  <span style="text-decoration: underline;">94</span>693 TMAX          <span style="text-decoration: underline;">1</span>946      <span style="text-decoration: underline;">2</span>021</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> ASN00…    -<span style="color: #BB0000;">35.1</span>      142.      50.3 ouye…  <span style="text-decoration: underline;">94</span>831 TMAX          <span style="text-decoration: underline;">1</span>957      <span style="text-decoration: underline;">2</span>021</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> ASN00…    -<span style="color: #BB0000;">35.1</span>      142.     105   walp…  <span style="text-decoration: underline;">95</span>831 TMAX          <span style="text-decoration: underline;">1</span>965      <span style="text-decoration: underline;">2</span>021</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> ASN00…    -<span style="color: #BB0000;">36.7</span>      142.     133   long…  <span style="text-decoration: underline;">95</span>835 TMAX          <span style="text-decoration: underline;">1</span>965      <span style="text-decoration: underline;">2</span>021</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> ASN00…    -<span style="color: #BB0000;">36.2</span>      145.      96   echu…  <span style="text-decoration: underline;">94</span>861 TMAX          <span style="text-decoration: underline;">1</span>957      <span style="text-decoration: underline;">2</span>021</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> ASN00…    -<span style="color: #BB0000;">35.7</span>      144.      77.7 kera…  <span style="text-decoration: underline;">94</span>844 TMAX          <span style="text-decoration: underline;">1</span>962      <span style="text-decoration: underline;">2</span>021</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> ASN00…    -<span style="color: #BB0000;">36.3</span>      145.     105   kyab…  <span style="text-decoration: underline;">95</span>833 TMAX          <span style="text-decoration: underline;">1</span>965      <span style="text-decoration: underline;">2</span>021</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> ASN00…    -<span style="color: #BB0000;">36.4</span>      145.     114   tatu…  <span style="text-decoration: underline;">95</span>836 TMAX          <span style="text-decoration: underline;">1</span>965      <span style="text-decoration: underline;">2</span>021</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> ASN00…    -<span style="color: #BB0000;">36.1</span>      147.     175   ruth…  <span style="text-decoration: underline;">95</span>837 TMAX          <span style="text-decoration: underline;">1</span>965      <span style="text-decoration: underline;">2</span>021</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">10</span> ASN00…    -<span style="color: #BB0000;">37.6</span>      150.      15.2 gabo…  <span style="text-decoration: underline;">94</span>933 TMAX          <span style="text-decoration: underline;">1</span>957      <span style="text-decoration: underline;">2</span>021</span>
<span class="co">#&gt; <span style="color: #949494;"># … with 14 more rows, and 2 more variables: id1 &lt;chr&gt;, ts &lt;list&gt;</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="temporal-manipulation">Temporal manipulation<a class="anchor" aria-label="anchor" href="#temporal-manipulation"></a>
</h2>
<p>Filtering on the year is an operation on the time dimension, <code><a href="../reference/stretch.html">stretch()</a></code> switches <code>tmax</code> to the long form:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tmax</span> <span class="op">&lt;-</span> <span class="va">tmax</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="../reference/stretch.html">stretch</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/year.html" class="external-link">year</a></span><span class="op">(</span><span class="va">date</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1971</span><span class="op">:</span><span class="fl">1975</span>, <span class="fl">2016</span><span class="op">:</span><span class="fl">2020</span><span class="op">)</span><span class="op">)</span>
<span class="va">tmax</span>
<span class="co">#&gt; <span style="color: #949494;"># cubble:  date, id [24]: long form</span></span>
<span class="co">#&gt; <span style="color: #949494;"># bbox:    [142, -39.13, 149.92, -34.23]</span></span>
<span class="co">#&gt; <span style="color: #949494;"># spatial: latitude [dbl], longitude [dbl], elevation [dbl], name [chr], wmo_id</span></span>
<span class="co"><span style="color: #949494;">#&gt; #   [dbl], element [chr], first_year [int], last_year [int], id1 [chr]</span></span>
<span class="co">#&gt;    id          date        tmax</span>
<span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> ASN00076031 1971-01-01  24.8</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> ASN00076031 1971-01-02  26  </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> ASN00076031 1971-01-03  26.6</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> ASN00076031 1971-01-04  28.2</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> ASN00076031 1971-01-05  31.9</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> ASN00076031 1971-01-06  36.7</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> ASN00076031 1971-01-07  39.2</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> ASN00076031 1971-01-08  42.3</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> ASN00076031 1971-01-09  30.7</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">10</span> ASN00076031 1971-01-10  30.6</span>
<span class="co">#&gt; <span style="color: #949494;"># … with 82,517 more rows</span></span></code></pre></div>
<p>We would also like to summarise the daily recording into monthly to smooth the maximum temperature and since it is also a time dimension operation, we can keep using the long form:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tmax</span> <span class="op">&lt;-</span> <span class="va">tmax</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span>month <span class="op">=</span> <span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/month.html" class="external-link">month</a></span><span class="op">(</span><span class="va">date</span><span class="op">)</span>,
           group <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/year.html" class="external-link">year</a></span><span class="op">(</span><span class="va">date</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">2015</span>,
                                    <span class="st">"2016 ~ 2020"</span>,<span class="st">"1971 ~ 1975"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>tmax <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">tmax</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>

<span class="va">tmax</span>
<span class="co">#&gt; <span style="color: #949494;"># cubble:  date, id [24]: long form</span></span>
<span class="co">#&gt; <span style="color: #949494;"># bbox:    [142, -39.13, 149.92, -34.23]</span></span>
<span class="co">#&gt; <span style="color: #949494;"># spatial: latitude [dbl], longitude [dbl], elevation [dbl], name [chr], wmo_id</span></span>
<span class="co"><span style="color: #949494;">#&gt; #   [dbl], element [chr], first_year [int], last_year [int], id1 [chr]</span></span>
<span class="co">#&gt;    id          month group        tmax</span>
<span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> ASN00076031     1 1971 ~ 1975  30.9</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> ASN00076031     1 2016 ~ 2020  35.0</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> ASN00076031     2 1971 ~ 1975  30.6</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> ASN00076031     2 2016 ~ 2020  32.9</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> ASN00076031     3 1971 ~ 1975  27.9</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> ASN00076031     3 2016 ~ 2020  30.5</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> ASN00076031     4 1971 ~ 1975  23.4</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> ASN00076031     4 2016 ~ 2020  25.3</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> ASN00076031     5 1971 ~ 1975  19.7</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">10</span> ASN00076031     5 2016 ~ 2020  19.5</span>
<span class="co">#&gt; <span style="color: #949494;"># … with 542 more rows</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="back-to-spatial">Back to spatial<a class="anchor" aria-label="anchor" href="#back-to-spatial"></a>
</h2>
<p>A data quality issue with the <code>rnoaa</code> data is that while it records the first and last year recorded of each series without the period of missingness. For example, station <code>ASN00047048</code> starts it first record in 1957, pauses for a period from 1963 to 1990, and then resumes it recording till today. We would like to remove stations like this by examining whether the summarised time series has a total of 24 months. This is a station-wise operation and <code><a href="../reference/tamp.html">tamp()</a></code> can be used to convert the cubble back to the nested form:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tmax</span> <span class="op">&lt;-</span> <span class="va">tmax</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="../reference/tamp.html">tamp</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">ts</span><span class="op">)</span> <span class="op">==</span> <span class="fl">24</span><span class="op">)</span>
<span class="va">tmax</span>
<span class="co">#&gt; <span style="color: #949494;"># cubble:   id [22]: nested form</span></span>
<span class="co">#&gt; <span style="color: #949494;"># bbox:     [142, -39.13, 149.92, -34.23]</span></span>
<span class="co">#&gt; <span style="color: #949494;"># temporal: month [dbl], group [fct], tmax [dbl]</span></span>
<span class="co">#&gt;    id     latitude longitude elevation name  wmo_id element first_year last_year</span>
<span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> ASN00…    -<span style="color: #BB0000;">34.2</span>      142.      50   mild…  <span style="text-decoration: underline;">94</span>693 TMAX          <span style="text-decoration: underline;">1</span>946      <span style="text-decoration: underline;">2</span>021</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> ASN00…    -<span style="color: #BB0000;">35.1</span>      142.      50.3 ouye…  <span style="text-decoration: underline;">94</span>831 TMAX          <span style="text-decoration: underline;">1</span>957      <span style="text-decoration: underline;">2</span>021</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> ASN00…    -<span style="color: #BB0000;">35.1</span>      142.     105   walp…  <span style="text-decoration: underline;">95</span>831 TMAX          <span style="text-decoration: underline;">1</span>965      <span style="text-decoration: underline;">2</span>021</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> ASN00…    -<span style="color: #BB0000;">36.7</span>      142.     133   long…  <span style="text-decoration: underline;">95</span>835 TMAX          <span style="text-decoration: underline;">1</span>965      <span style="text-decoration: underline;">2</span>021</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> ASN00…    -<span style="color: #BB0000;">36.2</span>      145.      96   echu…  <span style="text-decoration: underline;">94</span>861 TMAX          <span style="text-decoration: underline;">1</span>957      <span style="text-decoration: underline;">2</span>021</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> ASN00…    -<span style="color: #BB0000;">35.7</span>      144.      77.7 kera…  <span style="text-decoration: underline;">94</span>844 TMAX          <span style="text-decoration: underline;">1</span>962      <span style="text-decoration: underline;">2</span>021</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> ASN00…    -<span style="color: #BB0000;">36.3</span>      145.     105   kyab…  <span style="text-decoration: underline;">95</span>833 TMAX          <span style="text-decoration: underline;">1</span>965      <span style="text-decoration: underline;">2</span>021</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> ASN00…    -<span style="color: #BB0000;">36.4</span>      145.     114   tatu…  <span style="text-decoration: underline;">95</span>836 TMAX          <span style="text-decoration: underline;">1</span>965      <span style="text-decoration: underline;">2</span>021</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> ASN00…    -<span style="color: #BB0000;">36.1</span>      147.     175   ruth…  <span style="text-decoration: underline;">95</span>837 TMAX          <span style="text-decoration: underline;">1</span>965      <span style="text-decoration: underline;">2</span>021</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">10</span> ASN00…    -<span style="color: #BB0000;">37.6</span>      150.      15.2 gabo…  <span style="text-decoration: underline;">94</span>933 TMAX          <span style="text-decoration: underline;">1</span>957      <span style="text-decoration: underline;">2</span>021</span>
<span class="co">#&gt; <span style="color: #949494;"># … with 12 more rows, and 2 more variables: id1 &lt;chr&gt;, ts &lt;list&gt;</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="the-final-step">The final step<a class="anchor" aria-label="anchor" href="#the-final-step"></a>
</h2>
<p>In the glyph map we are about to create, the four variables (major and minor axis for x and y) need to be in the same table. In cubble, you can move time invariant variable into the long form with <code><a href="../reference/cubble-verb.html">migrate()</a></code>:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tmax</span> <span class="op">&lt;-</span> <span class="va">tmax</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="../reference/stretch.html">stretch</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="../reference/cubble-verb.html">migrate</a></span><span class="op">(</span><span class="va">latitude</span>, <span class="va">longitude</span><span class="op">)</span>
<span class="va">tmax</span>
<span class="co">#&gt; <span style="color: #949494;"># cubble:  date, id [22]: long form</span></span>
<span class="co">#&gt; <span style="color: #949494;"># bbox:    [142, -39.13, 149.92, -34.23]</span></span>
<span class="co">#&gt; <span style="color: #949494;"># spatial: latitude [dbl], longitude [dbl], elevation [dbl], name [chr], wmo_id</span></span>
<span class="co"><span style="color: #949494;">#&gt; #   [dbl], element [chr], first_year [int], last_year [int], id1 [chr]</span></span>
<span class="co">#&gt;    id          month group        tmax latitude longitude</span>
<span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> ASN00076031     1 1971 ~ 1975  30.9    -<span style="color: #BB0000;">34.2</span>      142.</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> ASN00076031     1 2016 ~ 2020  35.0    -<span style="color: #BB0000;">34.2</span>      142.</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> ASN00076031     2 1971 ~ 1975  30.6    -<span style="color: #BB0000;">34.2</span>      142.</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> ASN00076031     2 2016 ~ 2020  32.9    -<span style="color: #BB0000;">34.2</span>      142.</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> ASN00076031     3 1971 ~ 1975  27.9    -<span style="color: #BB0000;">34.2</span>      142.</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> ASN00076031     3 2016 ~ 2020  30.5    -<span style="color: #BB0000;">34.2</span>      142.</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> ASN00076031     4 1971 ~ 1975  23.4    -<span style="color: #BB0000;">34.2</span>      142.</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> ASN00076031     4 2016 ~ 2020  25.3    -<span style="color: #BB0000;">34.2</span>      142.</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> ASN00076031     5 1971 ~ 1975  19.7    -<span style="color: #BB0000;">34.2</span>      142.</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">10</span> ASN00076031     5 2016 ~ 2020  19.5    -<span style="color: #BB0000;">34.2</span>      142.</span>
<span class="co">#&gt; <span style="color: #949494;"># … with 518 more rows</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="glyph-map">Glyph map<a class="anchor" aria-label="anchor" href="#glyph-map"></a>
</h2>
<p>The <code>cubble</code> package also provides a <code>geom_glyph</code> interface to plot the glyph map. The geometry asks for <code>x_major</code>, <code>y_major</code>, <code>x_minor</code>, and <code>y_minor</code> as the required aesthetics:</p>
<!-- , "New South Wales" -->
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">nsw_vic</span> <span class="op">&lt;-</span> <span class="fu">ozmaps</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/ozmaps/man/abs-data.html" class="external-link">abs_ste</a></span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">NAME</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Victoria"</span><span class="op">)</span><span class="op">)</span>

<span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">nsw_vic</span>, fill <span class="op">=</span> <span class="st">"transparent"</span>, color <span class="op">=</span> <span class="st">"grey"</span>, linetype <span class="op">=</span> <span class="st">"dotted"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="../reference/glyph.html">geom_glyph</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">tmax</span>, 
             <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x_major <span class="op">=</span> <span class="va">longitude</span>, x_minor <span class="op">=</span> <span class="va">month</span>, 
                 y_major <span class="op">=</span> <span class="va">latitude</span>, y_minor <span class="op">=</span> <span class="va">tmax</span>,
                 group <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/interaction.html" class="external-link">interaction</a></span><span class="op">(</span><span class="va">id</span>, <span class="va">group</span><span class="op">)</span>, color <span class="op">=</span> <span class="va">group</span><span class="op">)</span>,
             width <span class="op">=</span> <span class="fl">1</span>, height <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html" class="external-link">scale_color_brewer</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Dark2"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">coord_sf</a></span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">141</span>, <span class="fl">150</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Longitude"</span>, y <span class="op">=</span> <span class="st">"Latitude"</span><span class="op">)</span>

<span class="va">p1</span></code></pre></div>
<p><img src="2-data-manip-with-cubble_files/figure-html/unnamed-chunk-7-1.png" width="100%"></p>
<p>We see, on average, a higher maximum temperature in the recent years as compared to the first half of 1970s. This is observable in the beginning of the year in most of stations in New South Wales and end of the year in both New South Wales and Victoria. Maximum temperature during winter doesn’t seem to change much in these two periods.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by H. Sherry Zhang, Dianne Cook, Ursula Laa, Nicolas Langrené, Patricia Menéndez.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.2.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
