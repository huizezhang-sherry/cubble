<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>2. Data manipulation with cubble • cubble</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="2. Data manipulation with cubble">
<meta property="og:description" content="cubble">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">cubble</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.0.1.0000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/0-create-cubble-from-wild.html">0. Creating a cubble from data in the wild</a>
    </li>
    <li>
      <a href="../articles/1-details-on-cubble-design.html">1. details-on-cubble-design</a>
    </li>
    <li>
      <a href="../articles/2-data-manip-with-cubble.html">2. Data manipulation with cubble</a>
    </li>
    <li>
      <a href="../articles/3-application-automated-stations.html">3. Application: Matching nearby stations</a>
    </li>
    <li>
      <a href="../articles/4-spatial-temporal-aggregation.html">4. Application: Spatial and temporal aggregation</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="2-data-manip-with-cubble_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>2. Data manipulation with cubble</h1>
            
      
      
      <div class="hidden name"><code>2-data-manip-with-cubble.Rmd</code></div>

    </div>

    
    
<p>This vignette introduces how to perform spatial and temporal manipulate in a cubble with dplyr verbs. We will illustrate with <code>weatherdata::historical_tmax</code> data, which have the historical maximum temperature recorded for Australian stations with the earliest dating back to 1859.</p>
<div class="section level2">
<h2 id="spatial-manipulation">Spatial manipulation<a class="anchor" aria-label="anchor" href="#spatial-manipulation"></a>
</h2>
<p><code>historical_tmax</code> is already in a nested cubble format, which is suitable for station-wise manipulation. <code>rnoaa</code> construct the station id by prefix <code>ASN00</code> to the Bureau of Meteorology (BOM) station number. In <a href="http://www.bom.gov.au/climate/cdo/about/site-num.shtml" class="external-link">BOM’s numbering system</a>, the 2nd and 3rd digit denotes the state a station is located in and this is equivalent to the 7th to 8th digit in our string. We can mutate/ filter station in a particular state based on this information and here we add a column called <code>state_id</code> and filter out the ones in New South Wales and Victoria (ranging from 46 to 90).</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tmax_nested</span> <span class="op">&lt;-</span> <span class="fu">weatherdata</span><span class="fu">::</span><span class="va">historical_tmax</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>state_id <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_sub.html" class="external-link">str_sub</a></span><span class="op">(</span><span class="va">id</span>, <span class="fl">7</span>, <span class="fl">8</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/between.html" class="external-link">between</a></span><span class="op">(</span><span class="va">state_id</span>, <span class="fl">46</span>, <span class="fl">90</span><span class="op">)</span><span class="op">)</span>

<span class="va">tmax_nested</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span>
<span class="co">#&gt; <span style="color: #949494;"># cubble:   id [5]: nested form</span></span>
<span class="co">#&gt; <span style="color: #949494;"># bbox:     [141.26, -34.04, 146.87, -29.96]</span></span>
<span class="co">#&gt; <span style="color: #949494;"># temporal: date [date], tmax [dbl]</span></span>
<span class="co">#&gt;   id     latitude longitude elevation name   wmo_id element first_year last_year</span>
<span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;">1</span> ASN00…    -<span style="color: #BB0000;">34.0</span>      141.       43  lake …  <span style="text-decoration: underline;">94</span>692 TMAX          <span style="text-decoration: underline;">1</span>966      <span style="text-decoration: underline;">2</span>021</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">2</span> ASN00…    -<span style="color: #BB0000;">32.4</span>      142.       61  menin…  <span style="text-decoration: underline;">94</span>694 TMAX          <span style="text-decoration: underline;">1</span>959      <span style="text-decoration: underline;">2</span>021</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">3</span> ASN00…    -<span style="color: #BB0000;">32.0</span>      141.      281. broke…  <span style="text-decoration: underline;">94</span>691 TMAX          <span style="text-decoration: underline;">1</span>957      <span style="text-decoration: underline;">2</span>021</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">4</span> ASN00…    -<span style="color: #BB0000;">30.0</span>      147.      115  brewa…  <span style="text-decoration: underline;">95</span>512 TMAX          <span style="text-decoration: underline;">1</span>965      <span style="text-decoration: underline;">2</span>021</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">5</span> ASN00…    -<span style="color: #BB0000;">31.5</span>      146.      260  cobar…  <span style="text-decoration: underline;">94</span>711 TMAX          <span style="text-decoration: underline;">1</span>962      <span style="text-decoration: underline;">2</span>021</span>
<span class="co">#&gt; <span style="color: #949494;"># … with 3 more variables: id1 &lt;chr&gt;, ts &lt;list&gt;, state_id &lt;chr&gt;</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="temporal-manipulation">Temporal manipulation<a class="anchor" aria-label="anchor" href="#temporal-manipulation"></a>
</h2>
<p>There are some operations in the time dimension we would like to make:</p>
<ul>
<li>Extract observations in a particular period, say, those in 1971 to 1975 and 2016 to 2020. This can be used to compare the historical and recent climate.</li>
<li>Summarise daily records into monthly to remove sparsity</li>
</ul>
<p>These time dimension operations can be computed in the long form and <code><a href="../reference/stretch.html">stretch()</a></code> converts a nested cubble to a long cubble. From a long cubble, we can write the exact same dplyr codes to complete the two tasks:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tmax_long</span> <span class="op">&lt;-</span> <span class="va">tmax_nested</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="../reference/stretch.html">stretch</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/year.html" class="external-link">year</a></span><span class="op">(</span><span class="va">date</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1971</span><span class="op">:</span><span class="fl">1975</span>, <span class="fl">2016</span><span class="op">:</span><span class="fl">2020</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>month <span class="op">=</span> <span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/month.html" class="external-link">month</a></span><span class="op">(</span><span class="va">date</span><span class="op">)</span>,
         group <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span>
           <span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/year.html" class="external-link">year</a></span><span class="op">(</span><span class="va">date</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">2015</span>,
           <span class="st">"2016 ~ 2020"</span>,
           <span class="st">"1971 ~ 1975"</span>
         <span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">month</span>, <span class="va">group</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>tmax <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">tmax</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>

<span class="va">tmax_long</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span>
<span class="co">#&gt; <span style="color: #949494;"># cubble:  date, id [1]: long form</span></span>
<span class="co">#&gt; <span style="color: #949494;"># bbox:    [141.26, -39.13, 153.37, -28.97]</span></span>
<span class="co">#&gt; <span style="color: #949494;"># spatial: latitude [dbl], longitude [dbl], elevation [dbl], name [chr], wmo_id</span></span>
<span class="co"><span style="color: #949494;">#&gt; #   [dbl], element [chr], first_year [int], last_year [int], id1 [chr],</span></span>
<span class="co"><span style="color: #949494;">#&gt; #   state_id [chr]</span></span>
<span class="co">#&gt;   id          month group        tmax</span>
<span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;">1</span> ASN00047016     1 1971 ~ 1975  31.1</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">2</span> ASN00047016     1 2016 ~ 2020  34.6</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">3</span> ASN00047016     2 1971 ~ 1975  30.9</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">4</span> ASN00047016     2 2016 ~ 2020  32.6</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">5</span> ASN00047016     3 1971 ~ 1975  28.1</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="back-to-spatial">Back to spatial<a class="anchor" aria-label="anchor" href="#back-to-spatial"></a>
</h2>
<p>A data quality issue with the <code>rnoaa</code> data is that while it records the first and last year recorded of each series, it doesn’t report the period of missingness. For example, station <code>ASN00047048</code> starts it first record in 1957, pauses for a period from 1963 to 1990, and then resumes it recording till today. Out of the 77 stations in New South Wales and Victoria, 7 stations have this issue and we would like to remove those stations from the comparison.</p>
<p>Again, this is a station-wise operation and to convert back from the long cubble to a nested one, use <code><a href="../reference/tamp.html">tamp()</a></code>. Here we keep the stations with 24 observations (12 months for both periods) after the monthly aggregation.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tmax_nested2</span> <span class="op">&lt;-</span> <span class="va">tmax_long</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="../reference/tamp.html">tamp</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">ts</span><span class="op">)</span> <span class="op">==</span> <span class="fl">24</span><span class="op">)</span>

<span class="va">tmax_nested2</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span>
<span class="co">#&gt; <span style="color: #949494;"># cubble:   id [5]: nested form</span></span>
<span class="co">#&gt; <span style="color: #949494;"># bbox:     [141.26, -34.04, 148.59, -29.54]</span></span>
<span class="co">#&gt; <span style="color: #949494;"># temporal: month [dbl], group [fct], tmax [dbl]</span></span>
<span class="co">#&gt;   id     latitude longitude elevation name   wmo_id element first_year last_year</span>
<span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;">1</span> ASN00…    -<span style="color: #BB0000;">34.0</span>      141.        43 lake …  <span style="text-decoration: underline;">94</span>692 TMAX          <span style="text-decoration: underline;">1</span>966      <span style="text-decoration: underline;">2</span>021</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">2</span> ASN00…    -<span style="color: #BB0000;">32.4</span>      142.        61 menin…  <span style="text-decoration: underline;">94</span>694 TMAX          <span style="text-decoration: underline;">1</span>959      <span style="text-decoration: underline;">2</span>021</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">3</span> ASN00…    -<span style="color: #BB0000;">30.0</span>      147.       115 brewa…  <span style="text-decoration: underline;">95</span>512 TMAX          <span style="text-decoration: underline;">1</span>965      <span style="text-decoration: underline;">2</span>021</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">4</span> ASN00…    -<span style="color: #BB0000;">31.5</span>      146.       260 cobar…  <span style="text-decoration: underline;">94</span>711 TMAX          <span style="text-decoration: underline;">1</span>962      <span style="text-decoration: underline;">2</span>021</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">5</span> ASN00…    -<span style="color: #BB0000;">29.5</span>      149.       145 colla…  <span style="text-decoration: underline;">95</span>520 TMAX          <span style="text-decoration: underline;">1</span>965      <span style="text-decoration: underline;">2</span>021</span>
<span class="co">#&gt; <span style="color: #949494;"># … with 3 more variables: id1 &lt;chr&gt;, state_id &lt;chr&gt;, ts &lt;list&gt;</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="the-final-step">The final step<a class="anchor" aria-label="anchor" href="#the-final-step"></a>
</h2>
<p>In some visualisation, we may need information from both spatial and temporal dimension. One example of this is a glyph map, where spatial variables, i.e. <code>longitude</code> and <code>latitude</code>, are used to construct the major axes and temporal variables, i.e. <code>month</code> and <code>tmax</code>, are used to construct the minor axes. This requires these variables to be in the same table, rather than in different forms. In cubble, you can append spatial variables that are invariant to the <code>key</code> withe <code><a href="../reference/cubble-verb.html">migrate()</a></code></p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tmax_long2</span> <span class="op">&lt;-</span> <span class="va">tmax_nested2</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="../reference/stretch.html">stretch</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="../reference/cubble-verb.html">migrate</a></span><span class="op">(</span><span class="va">latitude</span>, <span class="va">longitude</span><span class="op">)</span>

<span class="va">tmax_long2</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span>
<span class="co">#&gt; <span style="color: #949494;"># cubble:  date, id [1]: long form</span></span>
<span class="co">#&gt; <span style="color: #949494;"># bbox:    [141.26, -39.13, 153.37, -28.97]</span></span>
<span class="co">#&gt; <span style="color: #949494;"># spatial: latitude [dbl], longitude [dbl], elevation [dbl], name [chr], wmo_id</span></span>
<span class="co"><span style="color: #949494;">#&gt; #   [dbl], element [chr], first_year [int], last_year [int], id1 [chr],</span></span>
<span class="co"><span style="color: #949494;">#&gt; #   state_id [chr]</span></span>
<span class="co">#&gt;   id          month group        tmax latitude longitude</span>
<span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;">1</span> ASN00047016     1 1971 ~ 1975  31.1    -<span style="color: #BB0000;">34.0</span>      141.</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">2</span> ASN00047016     1 2016 ~ 2020  34.6    -<span style="color: #BB0000;">34.0</span>      141.</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">3</span> ASN00047016     2 1971 ~ 1975  30.9    -<span style="color: #BB0000;">34.0</span>      141.</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">4</span> ASN00047016     2 2016 ~ 2020  32.6    -<span style="color: #BB0000;">34.0</span>      141.</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">5</span> ASN00047016     3 1971 ~ 1975  28.1    -<span style="color: #BB0000;">34.0</span>      141.</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="glyph-map">Glyph map<a class="anchor" aria-label="anchor" href="#glyph-map"></a>
</h2>
<p>Now its time for the glyph map!</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">nsw_vic</span> <span class="op">&lt;-</span> <span class="fu">ozmaps</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/ozmaps/man/abs-data.html" class="external-link">abs_ste</a></span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">NAME</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Victoria"</span>, <span class="st">"New South Wales"</span><span class="op">)</span><span class="op">)</span>

<span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plot_map.html">plot_map</a></span><span class="op">(</span><span class="va">nsw_vic</span>, fill <span class="op">=</span> <span class="st">"transparent"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="../reference/glyph.html">geom_glyph</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">tmax_long2</span>, 
            <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x_major <span class="op">=</span> <span class="va">longitude</span>, y_major <span class="op">=</span> <span class="va">latitude</span>,
                x_minor <span class="op">=</span> <span class="va">month</span>, y_minor <span class="op">=</span> <span class="va">tmax</span>,
                group <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/interaction.html" class="external-link">interaction</a></span><span class="op">(</span><span class="va">group</span>, <span class="va">id</span><span class="op">)</span>, color <span class="op">=</span> <span class="va">group</span><span class="op">)</span>,
            height <span class="op">=</span> <span class="fl">0.8</span>, width <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html" class="external-link">scale_color_brewer</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Dark2"</span><span class="op">)</span>

<span class="va">p1</span></code></pre></div>
<p><img src="2-data-manip-with-cubble_files/figure-html/unnamed-chunk-6-1.png" width="100%"></p>
<p>We see, on average, a higher maximum temperature in the recent years as compared to the first half of 1970s. This is observable in the beginning of the year in most of stations in New South Wales and end of the year in both New South Wales and Victoria. Maximum temperature during winter doesn’t seem to change much in these two periods.</p>
<p>In order to know which month the average maximum temperature starts to diverge after winter in these two periods, we can inset a glyph with more detailed annotation on labels and axes. This can be done through the <code>ggimg</code> package where you first create the glyph you want to inset, save it, and use <code><a href="https://rdrr.io/pkg/ggimg/man/geom_point_img.html" class="external-link">ggimg::geom_point_img</a></code> to inset it as an image. Here we pick station <code>ASN00085072</code> to make the glyph and it says there has been a warmer November in recent years!</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tmax_long</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">id</span> <span class="op">==</span> <span class="st">"ASN00085072"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">month</span>,
             y <span class="op">=</span> <span class="va">tmax</span>,
             color <span class="op">=</span> <span class="va">group</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html" class="external-link">scale_color_brewer</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Dark2"</span>, guide <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">12</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Month"</span>, title <span class="op">=</span> <span class="st">"ASN00085072: East Sale Airport"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>
    aspect.ratio <span class="op">=</span> <span class="fl">0.5</span>,
    axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">20</span><span class="op">)</span>,
    title <span class="op">=</span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">20</span><span class="op">)</span>
  <span class="op">)</span>

<span class="co">#ggsave(filename = here::here("man/figures/hist-tmax-single.png"))</span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">box_df</span> <span class="op">&lt;-</span> <span class="va">tmax_nested</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">id</span> <span class="op">==</span> <span class="st">"ASN00085072"</span><span class="op">)</span>
<span class="va">single</span> <span class="op">&lt;-</span>
  <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>img <span class="op">=</span> <span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="st">"man/figures/hist-tmax-single.png"</span><span class="op">)</span><span class="op">)</span>
<span class="va">p1</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_rect</a></span><span class="op">(</span>
    data <span class="op">=</span> <span class="va">box_df</span>,
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>
      xmin <span class="op">=</span> <span class="va">longitude</span> <span class="op">-</span> <span class="fl">0.6</span>,
      xmax <span class="op">=</span> <span class="va">longitude</span> <span class="op">+</span> <span class="fl">0.6</span>,
      ymin <span class="op">=</span> <span class="va">latitude</span> <span class="op">-</span> <span class="fl">0.12</span>,
      ymax <span class="op">=</span> <span class="va">latitude</span> <span class="op">+</span> <span class="fl">0.2</span>
    <span class="op">)</span>,
    fill <span class="op">=</span> <span class="st">"transparent"</span>,
    color <span class="op">=</span> <span class="st">"black"</span>
  <span class="op">)</span> <span class="op">+</span>
  <span class="fu">ggimg</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ggimg/man/geom_point_img.html" class="external-link">geom_point_img</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">single</span>,
                        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">155</span>, y <span class="op">=</span> <span class="op">-</span><span class="fl">37</span>, img <span class="op">=</span> <span class="va">img</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">7</span><span class="op">)</span></code></pre></div>
<p><img src="2-data-manip-with-cubble_files/figure-html/unnamed-chunk-8-1.png" width="100%"></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by H. Sherry Zhang, Dianne Cook, Ursula Laa, Nicolas Langrené, Patricia Menéndez.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.2.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
