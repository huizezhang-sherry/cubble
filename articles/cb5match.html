<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>5. Matching different data sources • cubble</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="5. Matching different data sources">
<meta property="og:description" content="cubble">
<meta property="og:image" content="/logo.svg">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">cubble</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.3.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/cb1class.html">1. The cubble class</a>
    </li>
    <li>
      <a href="../articles/cb2create.html">2. Creation and coercion</a>
    </li>
    <li>
      <a href="../articles/cb3tsibblesf.html">3. Compatibility with tsibble and sf</a>
    </li>
    <li>
      <a href="../articles/cb4glyph.html">4. Making a glyph map</a>
    </li>
    <li>
      <a href="../articles/cb5match.html">5. Matching different data sources</a>
    </li>
    <li>
      <a href="../articles/cb6interactive.html">6. Interactive graphics</a>
    </li>
    <li>
      <a href="../articles/cb7misc.html">7. Answers to common questions and extra examples</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/huizezhang-sherry/cubble/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>5. Matching different data sources</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/huizezhang-sherry/cubble/blob/HEAD/vignettes/cb5match.Rmd" class="external-link"><code>vignettes/cb5match.Rmd</code></a></small>
      <div class="hidden name"><code>cb5match.Rmd</code></div>

    </div>

    
    
<p>One common task when working with spatio-temporal data is to match
nearby sites. For example, we may want to verify the location of an old
list of stations with current stations, or we may want to match the data
from different data sources. In this vignette, we will introduce the
spatial and temporal matching in cubble using an example on matching
river level data with precipitation in Victoria, Australia.</p>
<p>In cubble, spatial and temporal matching are performed using the
functions <code><a href="../reference/matching.html">match_spatial()</a></code> and
<code><a href="../reference/matching.html">match_temporal()</a></code>. The <code><a href="../reference/matching.html">match_spatial()</a></code> function
calculates the spatial distance between observations in two cubble
objects. Various distance measures are available (check
<code><a href="https://r-spatial.github.io/sf/reference/geos_measures.html" class="external-link">sf::st_distance</a></code>). Analysts can specify the number of
matched groups to output using the <code>spatial_n_group</code> argument
(default to 4 groups) and the number of matches per group using the
<code>spatial_n_group</code> argument (default to 1, one-to-one
matching). The syntax to use <code><a href="../reference/matching.html">match_spatial()</a></code> is:</p>
<pre><code>match_spatial(&lt;cubble_obj1&gt;, &lt;cubble_obj2&gt;, ...)</code></pre>
<p>The function <code><a href="../reference/matching.html">match_temporal()</a></code> calculates the similarity
between time series within spatially matched groups. Two identifiers are
required: one for separating each matched group (<code>match_id</code>)
and one for separating the two data sources (<code>data_id</code>). The
argument <code>temporal_by</code> uses the <code>by</code> syntax from
dplyr’s <code>*_join</code> to specify the temporal variables to
match.</p>
<p>The similarity score between two time series is calculated using a
matching function, which can be customised by the analysts. The matching
function takes two time series as a list and returns a single numerical
score. This allows for flexibility in using existing time series
distance calculation implementation. By default, cubble implements a
simple peak matching algorithm (<code>match_peak</code>) that counts the
number of peaks in two time series that fall within a specified temporal
window. The syntax to use <code><a href="../reference/matching.html">match_temporal()</a></code> is</p>
<pre><code>match_temporal(
  &lt;cubble_obj_from_match_spatial&gt;, 
  data_id = , match_id = , 
  temporal_by = c("..." = "...")
)</code></pre>
<div class="section level2">
<h2 id="spatial-matching">Spatial matching<a class="anchor" aria-label="anchor" href="#spatial-matching"></a>
</h2>
<p>Now let’s consider an example of matching water data from river
gauges with precipitation. The [water level data]((<a href="http://www.bom.gov.au/metadata/catalogue/19115/ANZCW0503900528?template=full" class="external-link uri">http://www.bom.gov.au/metadata/catalogue/19115/ANZCW0503900528?template=full</a>),
collected by the Bureau of Meteorology, can be compared with the
precipitation since rainfall can directly impact water level in river.
Here is the location of available weather stations and water gauges in
Victoria, Australia:</p>
<p><img src="cb5match_files/figure-html/unnamed-chunk-2-1.png" width="100%"></p>
<p>Both <code>climate_vic</code> and <code>river</code> are cubble
objects, and we can obtain a summary of the 10 closest pairs between
them:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="va">res_sp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/matching.html">match_spatial</a></span><span class="op">(</span><span class="va">climate_vic</span>, <span class="va">river</span>, spatial_n_group <span class="op">=</span> <span class="fl">10</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 10 × 4</span></span></span>
<span><span class="co">#&gt;    from        to      dist group</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494;">[m]</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> ASN00088051 406213 <span style="text-decoration: underline;">1</span>838.     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> ASN00084145 222201 <span style="text-decoration: underline;">2</span>185.     2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> ASN00085072 226027 <span style="text-decoration: underline;">3</span>282.     3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> ASN00080015 406704 <span style="text-decoration: underline;">4</span>034.     4</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> ASN00085298 226027 <span style="text-decoration: underline;">4</span>207.     5</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> ASN00082042 405234 <span style="text-decoration: underline;">6</span>153.     6</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> ASN00086038 230200 <span style="text-decoration: underline;">6</span>167.     7</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> ASN00086282 230200 <span style="text-decoration: underline;">6</span>928.     8</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> ASN00085279 224217 <span style="text-decoration: underline;">7</span>431.     9</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> ASN00080091 406756 <span style="text-decoration: underline;">7</span>460.    10</span></span></code></pre></div>
<p>The result can also be returned as cubble objects by setting the
argument <code>return_cubble = TRUE</code>. The output is be a list
where each element is a paired cubble object. To combine all the results
into a single cubble, you can use <code><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows()</a></code>. In the case
when a site in the second cubble (the <code>river</code> data here) is
matched to two stations in the first cubble (<code>climate_vic</code>
here), the binding may not be successful since cubble requires unique
rows in the nested form. In the summary table above, the river station
<code>226027</code> is matched to more than one weather station:
<code>ASN00085072</code> (group 3) and <code>ASN00085298</code> (group
5). Similarly, the river station <code>230200</code> is matched in group
7 and 8). In such cases, you can either deselect one pair before
combining, or work with the list output with the <code><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">purrr::map</a></code>
syntax:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">res_sp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/matching.html">match_spatial</a></span><span class="op">(</span><span class="va">climate_vic</span>, <span class="va">river</span>, spatial_n_group <span class="op">=</span> <span class="fl">10</span>, return_cubble <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">res_sp</span>, max.level <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 10</span></span>
<span><span class="va">res_sp</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># cubble:   key: id [2], index: date, nested form, [sf]</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># spatial:  [144.5203, -37.0194, 144.540295, -37.015122], WGS 84</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># temporal: date [date], prcp [dbl], tmax [dbl], tmin [dbl]</span></span></span>
<span><span class="co">#&gt;   id      long   lat  elev name  wmo_id ts       type              geometry</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;POINT [°]&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> ASN00…  145. -<span style="color: #BB0000;">37.0</span>   290 rede…  <span style="text-decoration: underline;">94</span>859 <span style="color: #949494;">&lt;tibble&gt;</span> clim…  (144.5203 -37.0194)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 406213  145. -<span style="color: #BB0000;">37.0</span>    <span style="color: #BB0000;">NA</span> CAMP…     <span style="color: #BB0000;">NA</span> <span style="color: #949494;">&lt;tibble&gt;</span> river (144.5403 -37.01512)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 2 more variables: group &lt;int&gt;, dist [m]</span></span></span>
<span><span class="op">(</span><span class="va">res_sp</span> <span class="op">&lt;-</span> <span class="va">res_sp</span><span class="op">[</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">8</span><span class="op">)</span><span class="op">]</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># cubble:   key: id [16], index: date, nested form, [sf]</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># spatial:  [144.5203, -38.144913, 148.4667, -36.128657], WGS 84</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># temporal: date [date], prcp [dbl], tmax [dbl], tmin [dbl]</span></span></span>
<span><span class="co">#&gt;    id     long   lat  elev name  wmo_id ts       type              geometry</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;POINT [°]&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> ASN0…  145. -<span style="color: #BB0000;">37.0</span> 290   rede…  <span style="text-decoration: underline;">94</span>859 <span style="color: #949494;">&lt;tibble&gt;</span> clim…  (144.5203 -37.0194)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 4062…  145. -<span style="color: #BB0000;">37.0</span>  <span style="color: #BB0000;">NA</span>   CAMP…     <span style="color: #BB0000;">NA</span> <span style="color: #949494;">&lt;tibble&gt;</span> river (144.5403 -37.01512)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> ASN0…  148. -<span style="color: #BB0000;">37.7</span>  62.7 orbo…  <span style="text-decoration: underline;">95</span>918 <span style="color: #949494;">&lt;tibble&gt;</span> clim…  (148.4667 -37.6922)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 2222…  148. -<span style="color: #BB0000;">37.7</span>  <span style="color: #BB0000;">NA</span>   SNOW…     <span style="color: #BB0000;">NA</span> <span style="color: #949494;">&lt;tibble&gt;</span> river  (148.451 -37.70739)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> ASN0…  147. -<span style="color: #BB0000;">38.1</span>   4.6 east…  <span style="text-decoration: underline;">94</span>907 <span style="color: #949494;">&lt;tibble&gt;</span> clim…  (147.1322 -38.1156)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 2260…  147. -<span style="color: #BB0000;">38.1</span>  <span style="color: #BB0000;">NA</span>   LA T…     <span style="color: #BB0000;">NA</span> <span style="color: #949494;">&lt;tibble&gt;</span> river (147.1278 -38.14491)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> ASN0…  145. -<span style="color: #BB0000;">36.2</span>  96   echu…  <span style="text-decoration: underline;">94</span>861 <span style="color: #949494;">&lt;tibble&gt;</span> clim…  (144.7642 -36.1647)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 4067…  145. -<span style="color: #BB0000;">36.1</span>  <span style="color: #BB0000;">NA</span>   DEAK…     <span style="color: #BB0000;">NA</span> <span style="color: #949494;">&lt;tibble&gt;</span> river (144.7693 -36.12866)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> ASN0…  146. -<span style="color: #BB0000;">36.8</span> 502   stra…  <span style="text-decoration: underline;">95</span>843 <span style="color: #949494;">&lt;tibble&gt;</span> clim…  (145.7308 -36.8472)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 4052…  146. -<span style="color: #BB0000;">36.9</span>  <span style="color: #BB0000;">NA</span>   SEVE…     <span style="color: #BB0000;">NA</span> <span style="color: #949494;">&lt;tibble&gt;</span> river (145.6828 -36.88701)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">11</span> ASN0…  145. -<span style="color: #BB0000;">37.7</span>  78.4 esse…  <span style="text-decoration: underline;">95</span>866 <span style="color: #949494;">&lt;tibble&gt;</span> clim…  (144.9066 -37.7276)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">12</span> 2302…  145. -<span style="color: #BB0000;">37.7</span>  <span style="color: #BB0000;">NA</span>   MARI…     <span style="color: #BB0000;">NA</span> <span style="color: #949494;">&lt;tibble&gt;</span> river (144.8365 -37.72771)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">13</span> ASN0…  148. -<span style="color: #BB0000;">37.9</span>  49.4 bair…  <span style="text-decoration: underline;">94</span>912 <span style="color: #949494;">&lt;tibble&gt;</span> clim…  (147.5669 -37.8817)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">14</span> 2242…  148. -<span style="color: #BB0000;">37.8</span>  <span style="color: #BB0000;">NA</span>   MITC…     <span style="color: #BB0000;">NA</span> <span style="color: #949494;">&lt;tibble&gt;</span> river   (147.5722 -37.815)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">15</span> ASN0…  145. -<span style="color: #BB0000;">36.3</span> 105   kyab…  <span style="text-decoration: underline;">95</span>833 <span style="color: #949494;">&lt;tibble&gt;</span> clim…   (145.0638 -36.335)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">16</span> 4067…  145. -<span style="color: #BB0000;">36.3</span>  <span style="color: #BB0000;">NA</span>   MOSQ…     <span style="color: #BB0000;">NA</span> <span style="color: #949494;">&lt;tibble&gt;</span> river (144.9809 -36.32871)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 2 more variables: group &lt;int&gt;, dist [m]</span></span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="temporal-matching">Temporal matching<a class="anchor" aria-label="anchor" href="#temporal-matching"></a>
</h2>
<p>For temporal matching, we match the variable
<code>Water_course_level</code> from the river data to <code>prcp</code>
in the weather station data. The variable <code>group</code> and
<code>types</code> identify the matching group and the two datasets:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="va">res_tm</span> <span class="op">&lt;-</span> <span class="va">res_sp</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/matching.html">match_temporal</a></span><span class="op">(</span></span>
<span>    data_id <span class="op">=</span> <span class="va">type</span>, match_id <span class="op">=</span> <span class="va">group</span>,</span>
<span>    temporal_by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"prcp"</span> <span class="op">=</span> <span class="st">"Water_course_level"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 8 × 2</span></span></span>
<span><span class="co">#&gt;   group match_res</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>     1        30</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>     2         5</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>     3        14</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>     4        20</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span>     6        23</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span>     7        26</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">7</span>     9        21</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">8</span>    10        14</span></span></code></pre></div>
<p>Similarly, the cubble output can be returned using the argument
<code>return_cubble = TRUE</code>. Here we select the four pairs with
the highest number of matching peaks:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">res_tm</span> <span class="op">&lt;-</span> <span class="va">res_sp</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/matching.html">match_temporal</a></span><span class="op">(</span></span>
<span>    data_id <span class="op">=</span> <span class="va">type</span>, match_id <span class="op">=</span> <span class="va">group</span>,</span>
<span>    temporal_by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"prcp"</span> <span class="op">=</span> <span class="st">"Water_course_level"</span><span class="op">)</span>,</span>
<span>    return_cubble <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="op">(</span><span class="va">res_tm</span> <span class="op">&lt;-</span> <span class="va">res_tm</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">group</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">7</span>, <span class="fl">6</span>, <span class="fl">9</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># cubble:   key: id [8], index: date, nested form, [sf]</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># spatial:  [144.5203, -37.8817, 147.572223, -36.8472], WGS 84</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># temporal: date [date], matched [dbl]</span></span></span>
<span><span class="co">#&gt;   id         long   lat  elev name  wmo_id type              geometry group</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;POINT [°]&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> ASN00088…  145. -<span style="color: #BB0000;">37.0</span> 290   rede…  <span style="text-decoration: underline;">94</span>859 clim…  (144.5203 -37.0194)     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 406213     145. -<span style="color: #BB0000;">37.0</span>  <span style="color: #BB0000;">NA</span>   CAMP…     <span style="color: #BB0000;">NA</span> river (144.5403 -37.01512)     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> ASN00082…  146. -<span style="color: #BB0000;">36.8</span> 502   stra…  <span style="text-decoration: underline;">95</span>843 clim…  (145.7308 -36.8472)     6</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> 405234     146. -<span style="color: #BB0000;">36.9</span>  <span style="color: #BB0000;">NA</span>   SEVE…     <span style="color: #BB0000;">NA</span> river (145.6828 -36.88701)     6</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> ASN00086…  145. -<span style="color: #BB0000;">37.7</span>  78.4 esse…  <span style="text-decoration: underline;">95</span>866 clim…  (144.9066 -37.7276)     7</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> 230200     145. -<span style="color: #BB0000;">37.7</span>  <span style="color: #BB0000;">NA</span>   MARI…     <span style="color: #BB0000;">NA</span> river (144.8365 -37.72771)     7</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">7</span> ASN00085…  148. -<span style="color: #BB0000;">37.9</span>  49.4 bair…  <span style="text-decoration: underline;">94</span>912 clim…  (147.5669 -37.8817)     9</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">8</span> 224217     148. -<span style="color: #BB0000;">37.8</span>  <span style="color: #BB0000;">NA</span>   MITC…     <span style="color: #BB0000;">NA</span> river   (147.5722 -37.815)     9</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 3 more variables: dist [m], ts &lt;list&gt;, match_res &lt;dbl&gt;</span></span></span></code></pre></div>
<p>And then we can visualise them in space or across time:</p>
<p><img src="cb5match_files/figure-html/unnamed-chunk-7-1.png" width="100%"></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by H. Sherry Zhang, Dianne Cook, Ursula Laa, Nicolas Langrené, Patricia Menéndez.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
